<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>自律自由</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="自律自由">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="自律自由">
<meta property="og:locale">
<meta property="article:author" content="姚刚">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="自律自由" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">自律自由</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-postgresql-同机物理异步主备库搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/03/postgresql-%E5%90%8C%E6%9C%BA%E7%89%A9%E7%90%86%E5%BC%82%E6%AD%A5%E4%B8%BB%E5%A4%87%E5%BA%93%E6%90%AD%E5%BB%BA/" class="article-date">
  <time datetime="2020-08-03T17:08:00.000Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/postgrepsql/">postgrepsql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/03/postgresql-%E5%90%8C%E6%9C%BA%E7%89%A9%E7%90%86%E5%BC%82%E6%AD%A5%E4%B8%BB%E5%A4%87%E5%BA%93%E6%90%AD%E5%BB%BA/">postgresql-同机物理异步主备库搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h4><p>​        之前一直学习oracle，鉴于国产替代化和去o，就了解学习一下其他mysql和pg数据库，发现pg很小巧灵活，特别是psql客户端感觉很好用，就是不知道实际生产使用时性能和安全相比怎么样。</p>
<h4 id="环境：（同一个主机）"><a href="#环境：（同一个主机）" class="headerlink" title="环境：（同一个主机）"></a>环境：（同一个主机）</h4><table>
<thead>
<tr>
<th align="left"></th>
<th>主机1</th>
<th>主机2</th>
</tr>
</thead>
<tbody><tr>
<td align="left">os_version</td>
<td>oracle Linux Server release 5.4 32位</td>
<td>oracle Linux Server release 5.4 32位</td>
</tr>
<tr>
<td align="left">ip</td>
<td>192.168.100.203</td>
<td>192.168.100.203</td>
</tr>
<tr>
<td align="left">pg_version</td>
<td>PostgreSQL 10.0 on i686-pc-linux-gnu</td>
<td>PostgreSQL 10.0 on i686-pc-linux-gnu</td>
</tr>
<tr>
<td align="left">pg_install_dir</td>
<td>/opt/pgsql</td>
<td>/opt/pgsql</td>
</tr>
<tr>
<td align="left">pg_data_dir</td>
<td>/pgdata/10/data</td>
<td>/pgdata2/10/data</td>
</tr>
</tbody></table>
<h4 id="1-修改主库相关参数"><a href="#1-修改主库相关参数" class="headerlink" title="1. 修改主库相关参数"></a>1. 修改主库相关参数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> archive_mode = <span class="string">&#x27;on&#x27;</span>;     <span class="comment">-- 启动归档模式</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> archive_command = <span class="string">&#x27;cp %p /pgdata/10/archive_wals/%f&#x27;</span>;  <span class="comment">-- 归档命令</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> wal_level = <span class="string">&#x27;replica&#x27;</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> max_wal_senders = <span class="number">10</span>;    <span class="comment">-- 默认就是10， 归档进程数</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> wal_keep_segments = <span class="number">512</span>;     <span class="comment">-- 默认为0，pg_wal保留的最小wal文件数量</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> hot_standby = <span class="string">&#x27;on&#x27;</span>;    <span class="comment">-- 默认为on，备库为read only状态</span></span><br></pre></td></tr></table></figure>

<h4 id="2-修改主库访问权限文件（本次是同机，如果是异机，需要主备host都加上各一行）"><a href="#2-修改主库访问权限文件（本次是同机，如果是异机，需要主备host都加上各一行）" class="headerlink" title="2. 修改主库访问权限文件（本次是同机，如果是异机，需要主备host都加上各一行）"></a>2. 修改主库访问权限文件（本次是同机，如果是异机，需要主备host都加上各一行）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim pg_hba.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">增加一行</span></span><br><span class="line">host    replication     repuser             192.168.100.203/32                 md5</span><br></pre></td></tr></table></figure>

<h4 id="3-重启主库（生效参数），新建replication用户"><a href="#3-重启主库（生效参数），新建replication用户" class="headerlink" title="3. 重启主库（生效参数），新建replication用户"></a>3. 重启主库（生效参数），新建replication用户</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pg_ctl <span class="keyword">stop</span> -D /pgdata/<span class="number">10</span>/<span class="keyword">data</span></span><br><span class="line">pg_ctl <span class="keyword">start</span> -D /pgdata/<span class="number">10</span>/<span class="keyword">data</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> repuser <span class="keyword">REPLICATION</span> LOGIN <span class="keyword">CONNECTION</span> <span class="keyword">LIMIT</span> <span class="number">5</span> ENCRYPTED <span class="keyword">PASSWORD</span> <span class="string">&#x27;re12a345&#x27;</span>;</span><br><span class="line"><span class="comment">-- 查看新建的用户角色</span></span><br><span class="line">\d pg_roles</span><br><span class="line"><span class="keyword">select</span> rolname <span class="keyword">from</span> pg_roles;</span><br></pre></td></tr></table></figure>

<h4 id="4-热备主库到备库位置"><a href="#4-热备主库到备库位置" class="headerlink" title="4. 热备主库到备库位置"></a>4. 热备主库到备库位置</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pg_start_backup(<span class="string">&#x27;standby_bak1&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd /pgdata/10/data/</span><br><span class="line">tar -zcf all_data.tgz * --exclude=pg_wal/*</span><br><span class="line">mv all_data.tgz  /pgdata2/10/data/</span><br><span class="line">cd /pgdata2/10/data/</span><br><span class="line">tar -zxvf all_data.tgz</span><br><span class="line">chown 700 ../data</span><br><span class="line"><span class="meta">#</span><span class="bash"> 清理</span></span><br><span class="line">rm -f all_data.tgz l</span><br><span class="line">rm -f postmaster.*</span><br><span class="line">rm -f logfile</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pg_stop_backup();</span><br></pre></td></tr></table></figure>

<h4 id="5-修改备份配置文件"><a href="#5-修改备份配置文件" class="headerlink" title="5. 修改备份配置文件"></a>5. 修改备份配置文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim postgresql.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 因为本次是同机，异机无需修改port</span></span><br><span class="line">----------------------------------------------------------------------------------</span><br><span class="line">port = 5433                             # (change requires restart)</span><br><span class="line">----------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">vim recovery.conf</span><br><span class="line">----------------------------------------------------------------------------------</span><br><span class="line">recovery_target_timeline = &#x27;latest&#x27;</span><br><span class="line">standby_mode = on # 启用备库查询</span><br><span class="line"></span><br><span class="line">primary_conninfo = &#x27;host=192.168.100.203 port=5432 user=repuser&#x27;  # 设置主库信息，密码由后面密码文件提供</span><br><span class="line">----------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<h4 id="6-设置主备库复制用户密码文件"><a href="#6-设置主备库复制用户密码文件" class="headerlink" title="6. 设置主备库复制用户密码文件"></a>6. 设置主备库复制用户密码文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">touch /home/postgres/.pgpass; chmod 600 /home/postgres/.pgpass</span><br><span class="line"></span><br><span class="line">vim /home/postgres/.pgpass</span><br><span class="line"><span class="meta">#</span><span class="bash"> 增加下面2行</span></span><br><span class="line">----------------------------------------------------------------------------------</span><br><span class="line">192.168.100.203:5432:replication:repuser:re12a345</span><br><span class="line">192.168.100.203:5433:replication:repuser:re12a345</span><br><span class="line">----------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<h4 id="7-启动备库（查看logfile有无异常，无异常则正确启动，提示entering-standby-mode，db接收只读连接）"><a href="#7-启动备库（查看logfile有无异常，无异常则正确启动，提示entering-standby-mode，db接收只读连接）" class="headerlink" title="7. 启动备库（查看logfile有无异常，无异常则正确启动，提示entering standby mode，db接收只读连接）"></a>7. 启动备库（查看logfile有无异常，无异常则正确启动，提示entering standby mode，db接收只读连接）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_ctl start -D /pgdata2/10/data/ -l logfile</span><br></pre></td></tr></table></figure>

<h4 id="8-检查数据同步"><a href="#8-检查数据同步" class="headerlink" title="8. 检查数据同步"></a>8. 检查数据同步</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看wal复制进程（显示2个wal receiver和sender进程）</span></span><br><span class="line">ps -ef |grep post|grep wal</span><br><span class="line"></span><br><span class="line">postgres 12055 12053  0 16:00 ?        00:00:00 postgres: wal receiver process   streaming 0/1E014558</span><br><span class="line">postgres 12056 11389  0 16:00 ?        00:00:00 postgres: wal sender process repuser 192.168.100.203(58787) streaming 0/1E014558</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 主库登录插入测试数据</span></span><br><span class="line">psql -d yg_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span> <span class="keyword">values</span> (<span class="number">8</span>,<span class="string">&#x27;yyy&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 备库登录查询测试数据</span></span><br><span class="line"></span><br><span class="line">psql -p 5433 -d yg_test</span><br><span class="line"></span><br><span class="line">yg_test@[local]:5433=<span class="comment">#select * from test;</span></span><br><span class="line"> id | name</span><br><span class="line"><span class="comment">----+------</span></span><br><span class="line">  1 | yg1</span><br><span class="line">  2 | yg2</span><br><span class="line">  3 | yg3</span><br><span class="line">  4 | yg4</span><br><span class="line">  5 | yg5</span><br><span class="line">  6 | yg6</span><br><span class="line">  7 | xxx</span><br><span class="line">  8 | yyy        <span class="comment">-- 备库正常同步收到主库刚刚插入的数据</span></span><br><span class="line">(8 rows)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 备库测试插入数据报错：（logfile中也会有提示）</span></span><br><span class="line">yg_test@[local]:5433=<span class="comment">#insert into test values (9,&#x27;zzz&#x27;);</span></span><br><span class="line">ERROR:  cannot <span class="keyword">execute</span> <span class="keyword">INSERT</span> <span class="keyword">in</span> a <span class="keyword">read</span>-<span class="keyword">only</span> <span class="keyword">transaction</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看replication状态</span></span><br><span class="line">yg_test@[<span class="keyword">local</span>]:<span class="number">5432</span>=<span class="comment">#select usename, application_name, client_addr, client_hostname, client_port, state, sync_state from pg_stat_replication;</span></span><br><span class="line"> usename | application_name |   client_addr   | client_hostname | client_port |   state   | sync_state</span><br><span class="line"><span class="comment">---------+------------------+-----------------+-----------------+-------------+-----------+------------</span></span><br><span class="line"> repuser | walreceiver      | <span class="number">192.168</span><span class="number">.100</span><span class="number">.203</span> |                 |       <span class="number">58787</span> | streaming | async</span><br><span class="line">(<span class="number">1</span> <span class="keyword">row</span>)</span><br></pre></td></tr></table></figure>

<p><strong>至此，本次简单pg同步搭建完毕，谢谢</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/03/postgresql-%E5%90%8C%E6%9C%BA%E7%89%A9%E7%90%86%E5%BC%82%E6%AD%A5%E4%B8%BB%E5%A4%87%E5%BA%93%E6%90%AD%E5%BB%BA/" data-id="ckdegxste000wiscsg55d0d55" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/database/" rel="tag">database</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pg10/" rel="tag">pg10</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/postgrepsql/" rel="tag">postgrepsql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-12.2.0_RAC_ORACLE_HOME_chmod和chown惨案恢复一例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/03/12.2.0_RAC_ORACLE_HOME_chmod%E5%92%8Cchown%E6%83%A8%E6%A1%88%E6%81%A2%E5%A4%8D%E4%B8%80%E4%BE%8B/" class="article-date">
  <time datetime="2020-08-03T12:06:59.043Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/oracle-12c-rac/">oracle 12c rac</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/03/12.2.0_RAC_ORACLE_HOME_chmod%E5%92%8Cchown%E6%83%A8%E6%A1%88%E6%81%A2%E5%A4%8D%E4%B8%80%E4%BE%8B/">12.2.0 RAC ORACLE_HOME chmod/chown惨案恢复一例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><table>
<thead>
<tr>
<th>操作系统</th>
<th>CentOS release 6.9 (Final)</th>
</tr>
</thead>
<tbody><tr>
<td>数据库版本</td>
<td>Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production（2节点相同版本grid集群环境）</td>
</tr>
</tbody></table>
<h3 id="故障简介"><a href="#故障简介" class="headerlink" title="故障简介"></a>故障简介</h3><p>*有个同事初装RAC，觉得参照文档不够，可能涉及个别参数计算吧，于是打开生产RAC集群cat查看配置，结果误操作，在生产RAC节点1上面执行:  *</p>
<p><em>chown -R grid:asmadmin /u01</em></p>
<p><em>chmod -R 755 /u01</em></p>
<p>*然后给我说她好像操作错服务器了，我瞬间有点头疼，于是第二天果然没时间起来洗头了  ^ _^ *</p>
<hr>
<p>​          我首先查看集群状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crsctl <span class="built_in">stat</span> res -t  <span class="comment"># 使用root执行，2节点资源看起来都正常，主要是没重启服务，所以权限改了暂时还没蹦</span></span><br></pre></td></tr></table></figure>

<p>​         然后查看数据库alert日志，有很多权限错误报出来，我用oracle用户去ORACLE_HOME/bin下面一看，oracle文件也是755了，那新的服务器进程估计是起不来，估计会有问题，我为了不影响后面进来的服务，决定把vip先从node01转移到node02：         </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">status vip -node node01        <span class="comment"># 输出node01 vip地址信息</span></span><br><span class="line">relocate vip -vip 192.168.1.212 -node node02</span><br></pre></td></tr></table></figure>

<p>​        由于在中午，出问题比较严重，也比较忙，所以决定等晚上下班后在修复node01问题，出事了影响也比较小。</p>
<p>​        然后又怕集群node01启动新进程故障，导致影响服务，于是乎直接把node01节点停止了（<strong>其实这一步错了，应该先进性集群检查一下组件资源的，关闭就校验不了， 后面自己实验机上面试试，看看集群校验后能不能简单修复： cluvfy comp software -n all -verbose</strong>）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crsctl stop crs        <span class="comment"># 如果异常 加上 -f</span></span><br></pre></td></tr></table></figure>

<p>​        晚上开搞，原以为把grid和oracle用户的$ORACLE_HOME/bin给tar -cpf带权限打包和解压恢复过去，然后启动集群，结果和意料中一样，起不来，查看集群日志很少，就报错不能获取chm资源信息，好像是集群健康监控资源，可能是集群pmon进程有关，不太懂。</p>
<p>​        于是只能Google和mos，找到2个itpub教程和mos教程。</p>
<hr>
<h3 id="正文：节点集群恢复"><a href="#正文：节点集群恢复" class="headerlink" title="正文：节点集群恢复"></a>正文：节点集群恢复</h3><p>​        如果没有mos账号不方便，可以使用下面脚本，我将权限收集脚本放于这里：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">touch permission.pl    <span class="comment"># 在 node02 正确权限的节点使用 root 执行</span></span><br><span class="line">chmod +x permission.pl</span><br><span class="line">vim permission.pl <span class="comment"># 将下面代码贴入保存退出</span></span><br><span class="line">./permission.pl /u01 <span class="comment"># 收集所有/u01文件权限，生成2个文件 permission-时间戳 和 restore-perm-&lt;timestamp&gt;.cmd （一个是文件权限记录，一个是还原命令脚本）</span></span><br></pre></td></tr></table></figure>

<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/perl -w</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Captures file permissions and the owner of the files</span></span><br><span class="line"><span class="comment"># useage : perm1.pl &lt;path to capture permission&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># MODIFIED</span></span><br><span class="line"><span class="comment">#     uaswatha   12th March 2018  address filename with spaces (request from customer)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> strict;</span><br><span class="line"><span class="keyword">use</span> warnings;</span><br><span class="line"><span class="keyword">use</span> File::Find;</span><br><span class="line"><span class="keyword">use</span> POSIX();</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> (@dir) = @ARGV;</span><br><span class="line"><span class="keyword">my</span> $linecount=<span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">#print @ARGV, $#ARGV;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($#ARGV &lt; <span class="number">0</span>) &#123;</span><br><span class="line">   <span class="keyword">print</span> <span class="string">&quot;\n\nOpps....Invalid Syntax !!!!\n&quot;</span> ;</span><br><span class="line">   <span class="keyword">print</span> <span class="string">&quot;Usage   : ./perm1.pl &lt;path to capture permission&gt;\n\n&quot;</span> ;</span><br><span class="line">   <span class="keyword">print</span> <span class="string">&quot;Example : ./perm1.pl /home/oralce\n\n&quot;</span> ;</span><br><span class="line">   <span class="keyword">exit</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">my</span> $logdir=$dir[<span class="number">0</span>] ;</span><br><span class="line"><span class="comment">#my ($sec, $min, $hr, $day, $mon, $year) = localtime;</span></span><br><span class="line"><span class="comment">##my ($dow,$mon,$date,$hr,$min,$sec,$year) = POSIX::strftime( &#x27;%a %b %d %H %M %S %Y&#x27;, localtime);</span></span><br><span class="line"><span class="keyword">my</span> $date = POSIX::strftime( <span class="string">&#x27;%a-%b-%d-%H-%M-%S-%Y&#x27;</span>, <span class="keyword">localtime</span>);</span><br><span class="line"><span class="keyword">my</span> $logfile=<span class="string">&quot;permission-&quot;</span>.$date;</span><br><span class="line"><span class="keyword">my</span> $cmdfile=<span class="string">&quot;restore-perm-&quot;</span>.$date.<span class="string">&quot;.cmd&quot;</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> LOGFILE, <span class="string">&quot;&gt; $logfile&quot;</span> <span class="keyword">or</span> <span class="keyword">die</span> $! ;</span><br><span class="line"><span class="keyword">open</span> CMDFILE, <span class="string">&quot;&gt; $cmdfile&quot;</span> <span class="keyword">or</span> <span class="keyword">die</span> $! ;</span><br><span class="line">find(\&amp;process_file,@dir);</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;Following log files are generated\n&quot;</span> ;</span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;logfile      : &quot;</span>.$logfile. <span class="string">&quot;\n&quot;</span> ;</span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;Command file : &quot;</span>.$cmdfile. <span class="string">&quot;\n&quot;</span> ;</span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;Linecount : &quot;</span>.$linecount.<span class="string">&quot;\n&quot;</span> ;</span><br><span class="line"><span class="keyword">close</span> (LOGFILE) ;</span><br><span class="line"><span class="keyword">close</span> (CMDFILE) ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">process_file</span> </span>&#123;</span><br><span class="line">    <span class="keyword">my</span> ($dev,$ino,$mode,$nlink,$uid,$gid,$rdev,$size, $atime,$mtime,$ctime,$blksize,$blocks,$username,$user,$pass,$comment,$home,$shell,$group);</span><br><span class="line">    <span class="keyword">my</span> %uiduname = () ;</span><br><span class="line">    <span class="keyword">my</span> %gidgname = () ;</span><br><span class="line">    <span class="keyword">my</span> $filename = $File::Find::name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### Building uid, username hash</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> (PASSWDFILE, <span class="string">&#x27;/etc/passwd&#x27;</span>) ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ( &lt;PASSWDFILE&gt;) &#123;</span><br><span class="line">       ($user,$pass,$uid,$gid,$comment,$home,$shell)=<span class="keyword">split</span> (<span class="regexp">/:/</span>) ;</span><br><span class="line">       $uiduname&#123;$uid&#125;=$user ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">close</span> (PASSWDFILE) ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### Building gid, groupname hash</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> (GRPFILE, <span class="string">&#x27;/etc/group&#x27;</span>) ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ( &lt;GRPFILE&gt;) &#123;</span><br><span class="line">       ($group,$pass,$gid)=<span class="keyword">split</span> (<span class="regexp">/:/</span>) ;</span><br><span class="line">       $gidgname&#123;$gid&#125;=$group ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">close</span> (GRPFILE) ;</span><br><span class="line"></span><br><span class="line">    ($dev,$ino,$mode,$nlink,$uid,$gid,$rdev,$size, $atime,$mtime,$ctime,$blksize,$blocks) = <span class="keyword">stat</span>(<span class="string">&quot;$filename&quot;</span>);</span><br><span class="line"><span class="comment">#    printf  &quot;%o %s %s %s\n&quot;, $mode &amp; 07777, $uiduname&#123;$uid&#125;, $gidgname&#123;$gid&#125;, $filename ;</span></span><br><span class="line">     <span class="keyword">printf</span> LOGFILE <span class="string">&quot;%o %s %s %s\n&quot;</span>, $mode &amp; <span class="number">07777</span>, $uiduname&#123;$uid&#125;, $gidgname&#123;$gid&#125;, <span class="string">&quot;\&quot;$filename\&quot;&quot;</span> ;</span><br><span class="line">     <span class="keyword">printf</span> CMDFILE <span class="string">&quot;%s %s%s%s %s\n&quot;</span>, <span class="string">&quot;chown &quot;</span>,$uiduname&#123;$uid&#125;, <span class="string">&quot;:&quot;</span>, $gidgname&#123;$gid&#125;, <span class="string">&quot;\&quot;$filename\&quot;&quot;</span> ;</span><br><span class="line">     <span class="keyword">printf</span> CMDFILE <span class="string">&quot;%s %o %s\n&quot;</span>, <span class="string">&quot;chmod &quot;</span>,$mode &amp; <span class="number">07777</span>, <span class="string">&quot;\&quot;$filename\&quot;&quot;</span> ;</span><br><span class="line">    <span class="comment">#    printf  &quot;%o %s %s %s\n&quot;, $mode &amp; 07777, $uiduname&#123;$uid&#125;, $gidgname&#123;$gid&#125;, \&quot;,$filename,\&quot; ;</span></span><br><span class="line">    $linecount++ ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将 restore-perm-&lt;timestamp&gt;.cmd 脚本拷贝到 node01，使用root执行，恢复 node01 权限</span></span><br><span class="line"><span class="comment"># 注意需要讲node02的主机名和SID_NAME相应修改为node01的再执行</span></span><br><span class="line">chmod +x restore-perm-&lt;timestamp&gt;.cmd </span><br><span class="line">./restore-perm-&lt;timestamp&gt;.cmd    <span class="comment"># 到此，近百万文件，需要等一会，大概十几分钟 </span></span><br></pre></td></tr></table></figure>

<p>此时，大部分重要文件权限应该都恢复了，少部分日志或者其他文件，由于2节点不全部一致，所以没办法，这是一个小隐患（所以还是推荐删除节点，再把节点添加进来，只是相对麻烦一些）但启动集群还是报错，和之前无区别，报错日志很少，卡很久才提示还是集群资源chm无法获取，这时再重新初始化集群即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /u01/app/12.2.0/grid/crs/install</span><br><span class="line">./rootcrs.sh -init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后，再启动集群就正常不报错了（其实不改权限直接重新初始化集群应该也可以启动，不过保险还是建议使用permission脚本修改权限，Linux下面有个命令也可以收集和应用目录权限）</span></span><br><span class="line">./bin/crsctl start crs</span><br><span class="line">./bin/crsctl <span class="built_in">stat</span> res -t</span><br></pre></td></tr></table></figure>

<p><strong>至此，本次RAC node01 chmod和chown误操作恢复！</strong></p>
<p><em>因水平有限，如果有误，欢迎指正，不喜勿喷，希望能帮到大家    ^ · ^</em></p>
<hr>
<p><strong>参考大神博客和mos文档</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://blog.itpub.net/26736162/viewspace-2121470/">http://blog.itpub.net/26736162/viewspace-2121470/</a></p>
<p><a target="_blank" rel="noopener" href="https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=301737138237704&amp;id=1515018.1&amp;_adf.ctrl-state=z4x11tl1y_9">https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=301737138237704&amp;id=1515018.1&amp;_adf.ctrl-state=z4x11tl1y_9</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/03/12.2.0_RAC_ORACLE_HOME_chmod%E5%92%8Cchown%E6%83%A8%E6%A1%88%E6%81%A2%E5%A4%8D%E4%B8%80%E4%BE%8B/" data-id="ckdegxssn0000iscs26jo4hgl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rac/" rel="tag">rac</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-data_guard_broker_简单使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/03/data_guard_broker_%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2020-08-03T12:06:59.043Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/oracle/">oracle</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/03/data_guard_broker_%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/">data guard broker 简单使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="data-guard-broker-简单使用"><a href="#data-guard-broker-简单使用" class="headerlink" title="data guard broker 简单使用"></a>data guard broker 简单使用</h1><blockquote>
<p><strong>前提: 需要提前搭建好data guard (如果还未搭建，可参考我duplicate建dg，比较简单)</strong></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.notion.so/8c29b9439ae645278ea7825fd3586a45">环境信息</a></p>
<ol>
<li><p><strong>配置主库的dg broker静态监听</strong></p>
<pre><code> LISTENER=
   (DESCRIPTION=
     (ADDRESS_LIST=
       (ADDRESS=(PROTOCOL=tcp)(HOST=192.168.100.203)(PORT=1521))
       (ADDRESS=(PROTOCOL=ipc)(KEY=extproc))))
 SID_LIST_LISTENER=
   (SID_LIST=
     (SID_DESC=
       (GLOBAL_DBNAME=SRM)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (SID_NAME=SRM))
     (SID_DESC=
       (SID_NAME=SRM)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (GLOBAL_DBNAME=SRM_DGB))
     (SID_DESC=
       (SID_NAME=SRM)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (GLOBAL_DBNAME=SRM_DGMGRL)))</code></pre>
</li>
<li><p><strong>配置主库的dg broker静态监听</strong></p>
<pre><code> LISTENER=
   (DESCRIPTION=
     (ADDRESS_LIST=
       (ADDRESS=(PROTOCOL=tcp)(HOST=192.168.100.204)(PORT=1521))
       (ADDRESS=(PROTOCOL=ipc)(KEY=extproc))))
 SID_LIST_LISTENER=
   (SID_LIST=
     (SID_DESC=
       (GLOBAL_DBNAME=SRMDG_DGMGRL)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (SID_NAME=SRMDG))
     (SID_DESC=
       (GLOBAL_DBNAME=SRMDG)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (SID_NAME=SRMDG))
     (SID_DESC=
       (GLOBAL_DBNAME=SRMDG_DGB)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (SID_NAME=SRMDG)))</code></pre>
</li>
<li><p><strong>在主库和备库分别启动dg_broker</strong></p>
<pre><code> -- show parameter dg_broker_start;
 alter system set dg_broker_start=true;</code></pre>
</li>
<li><p><strong>在主库创建dg_broker配置文件</strong></p>
<pre><code> [oracle@localhost ~]$ dgmgrl
 DGMGRL for Linux: Version 11.2.0.4.0 - 64bit Production

 Copyright (c) 2000, 2009, Oracle. All rights reserved.

 Welcome to DGMGRL, type &quot;help&quot; for information.
 DGMGRL&gt; connect sys/oracle@srm
 Connected.
 DGMGRL&gt; help
 DGMGRL&gt; help create 

 create configuration yg_srm_dgBroker as
   primary database is SRM
   connect identifier is SRM;</code></pre>
</li>
<li><p><strong>添加standby备库</strong></p>
<pre><code> DGMGRL&gt; add database srmdg as connect identifier is srmdg maintained as physical;</code></pre>
</li>
<li><p><strong>查看配置</strong></p>
<pre><code> DGMGRL&gt; show CONFIGURATION;

 Configuration - yg_srm_dgbroker

   Protection Mode: MaxPerformance
   Databases:
     srm   - Primary database
     srmdg - Physical standby database (disabled)

 --如果standby未启用，则启用一下
 DGMGRL&gt; enable database srmdg;</code></pre>
</li>
<li><p><strong>再次查看详细配置</strong></p>
<pre><code> DGMGRL&gt; show configuration verbose

 Configuration - yg_srm_dgbroker

   Protection Mode: MaxPerformance
   Databases:
     srm   - Primary database
     srmdg - Physical standby database

   Properties:
     FastStartFailoverThreshold      = &#39;30&#39;
     OperationTimeout                = &#39;30&#39;
     FastStartFailoverLagLimit       = &#39;30&#39;
     CommunicationTimeout            = &#39;1800&#39;
     ObserverReconnect               = &#39;0&#39;
     FastStartFailoverAutoReinstate  = &#39;TRUE&#39;
     FastStartFailoverPmyShutdown    = &#39;TRUE&#39;
     BystandersFollowRoleChange      = &#39;ALL&#39;
     ObserverOverride                = &#39;FALSE&#39;
     ExternalDestination1            = &#39;&#39;
     ExternalDestination2            = &#39;&#39;
     PrimaryLostWriteAction          = &#39;CONTINUE&#39;

 Fast-Start Failover: DISABLED

 Configuration Status:
 SUCCESS</code></pre>
</li>
<li><p><strong>第一次测试switchover</strong></p>
<pre><code> DGMGRL&gt; switchover to srmdg</code></pre>
</li>
<li><p><strong>验证</strong></p>
<pre><code> SQL&gt; set line 200
 SQL&gt; col name for a20
 SQL&gt; col open_mode for a20
 SQL&gt; select name, open_mode, database_role, switchover_status from v$database;</code></pre>
</li>
<li><p><strong>第二次切换回来</strong></p>
<pre><code>DGMGRL&gt; switchover to srm</code></pre>
<blockquote>
<p><strong>在本地搭建dg broker过程中备库启用后遇到错误：Error: ORA-16664: unable to receive the result from a database</strong></p>
</blockquote>
<hr>
<pre><code># trace/drcSRM.log日志一直报错 Physical Standby Database srmdg Error ORA-16664 
# trace/alert_SRM.log日志中一直报错 , Fatal NI connect error 12514, connecting to: (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.100.204)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=srmdg_DGB)(CID=(PROGRAM=oracle)(HOST=localhost.localdomain)(USER=oracle))))

解决：

最后在 监听配置文件中加上 sid_DGB 的静态监听才解决,也就是上面的静态监听中的这段：

(SID_DESC=
(GLOBAL_DBNAME=SRMDG_DGB)
(ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
(SID_NAME=SRMDG))</code></pre>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/03/data_guard_broker_%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" data-id="ckdegxsst0001iscs926g2grd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/broker/" rel="tag">broker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/data-guard/" rel="tag">data guard</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-duplicate基于active源库复制数据库" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/03/duplicate%E5%9F%BA%E4%BA%8Eactive%E6%BA%90%E5%BA%93%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93/" class="article-date">
  <time datetime="2020-08-03T12:06:59.043Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/oracle/">oracle</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/03/duplicate%E5%9F%BA%E4%BA%8Eactive%E6%BA%90%E5%BA%93%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93/">duplicate db from active database/duplicate复制数据库</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>源库需要开启归档，不需要备份，不会影响源库（当然，一点点clone性能除外）</strong></p>
<p><em>channel使用target库，可以配置 parallelism</em></p>
<p><strong><em>环境信息</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">source db:</span><br><span class="line"></span><br><span class="line">sid&#x3D;SRM</span><br><span class="line">db_name &#x3D; SRM</span><br><span class="line">db_file_path &#x3D; &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM&#x2F;</span><br><span class="line">sys_pwd &#x3D; oracle</span><br><span class="line">oracle_version &#x3D; Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</span><br><span class="line">服务器资源 &#x3D; 4核4G内存40G磁盘</span><br><span class="line">OS &#x3D; CentOS Linux release 7.6.1810 (Core)</span><br></pre></td></tr></table></figure>
<p>###操作步骤<br>####1. 启动auxiliary instance</p>
<p><strong>1）. 新建静态listener – 注意 sid 区分大小写，一定要和ORACLE_SID一样</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">lsnrctl stop</span><br><span class="line">vim listener.ora</span><br><span class="line">---------------------------------------------------------------------------------------</span><br><span class="line">LISTENER&#x3D;</span><br><span class="line">  (DESCRIPTION&#x3D;</span><br><span class="line">    (ADDRESS_LIST&#x3D;</span><br><span class="line">      (ADDRESS&#x3D;(PROTOCOL&#x3D;tcp)(HOST&#x3D;localhost)(PORT&#x3D;1521))</span><br><span class="line">      (ADDRESS&#x3D;(PROTOCOL&#x3D;ipc)(KEY&#x3D;extproc))))</span><br><span class="line">SID_LIST_LISTENER&#x3D;</span><br><span class="line">  (SID_LIST&#x3D;</span><br><span class="line">    (SID_DESC&#x3D;</span><br><span class="line">      (GLOBAL_DBNAME&#x3D;SRM)</span><br><span class="line">      (ORACLE_HOME&#x3D;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;11.2.0&#x2F;dbhome_1)</span><br><span class="line">      (SID_NAME&#x3D;SRM))</span><br><span class="line">    (SID_DESC&#x3D;</span><br><span class="line">      (GLOBAL_DBNAME&#x3D;SRM2)</span><br><span class="line">      (ORACLE_HOME&#x3D;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;11.2.0&#x2F;dbhome_1)</span><br><span class="line">      (SID_NAME&#x3D;SRM2))</span><br><span class="line">  )</span><br><span class="line">---------------------------------------------------------------------------------------</span><br><span class="line">lsnrctl start</span><br><span class="line">lsnrctl status</span><br></pre></td></tr></table></figure>

<p><strong>2）增加tns</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">---------------------------------------------------------------------------------------</span><br><span class="line">SRM &#x3D;</span><br><span class="line">  (DESCRIPTION &#x3D;</span><br><span class="line">    (ADDRESS_LIST &#x3D;</span><br><span class="line">      (ADDRESS &#x3D; (PROTOCOL &#x3D; TCP)(HOST &#x3D; localhost.localdomain)(PORT &#x3D; 1521))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA &#x3D;</span><br><span class="line">      (SERVER &#x3D; DEDICATED)</span><br><span class="line">      (SERVICE_NAME &#x3D; SRM)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">SRM2 &#x3D;</span><br><span class="line">  (DESCRIPTION &#x3D;</span><br><span class="line">    (ADDRESS_LIST &#x3D;</span><br><span class="line">      (ADDRESS &#x3D; (PROTOCOL &#x3D; TCP)(HOST &#x3D; localhost.localdomain)(PORT &#x3D; 1521))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA &#x3D;</span><br><span class="line">      (SERVER &#x3D; DEDICATED)</span><br><span class="line">      (SERVICE_NAME &#x3D; SRM2)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">---------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p><strong>3）复制密码文件，或者新建</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oracle@yg-test dbs]$ cp orapwSRM orapwSRM2</span><br></pre></td></tr></table></figure>

<p>*<em>4）创建pfile并修改启动nomount, 注意: 如果自己创建pfile要加上：</em>.compatible=’11.2.0.4.0’**</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create pfile&#x3D;&#39;&#x2F;home&#x2F;oracle&#x2F;dup_pfile.ora&#39; from spfile;</span><br></pre></td></tr></table></figure>

<p><strong>5）修改dup_pfile.ora中的：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*.db_name&#x3D;&#39;SRM2&#39;</span><br><span class="line">*.audit_file_dest&#x3D;&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;admin&#x2F;SRM2&#x2F;adump&#39;</span><br><span class="line">*.control_files&#x3D;&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM2&#x2F;control01.ctl&#39;,&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM2&#x2F;control02.ctl&#39;</span><br></pre></td></tr></table></figure>

<p><strong>6）添加参数</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db_file_name_convert&#x3D;&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM&#39;,&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM2&#39;</span><br><span class="line">log_file_name_convert&#x3D;&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM&#39;,&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM2&#39;</span><br></pre></td></tr></table></figure>

<p><strong>7）新建dup库的新文件夹：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;admin&#x2F;SRM2&#x2F;adump &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>####2. 开始基于源库duplicate</p>
<p><strong>1）修改环境变量ORACLE_SID: SRM –&gt; SRM2</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export ORACLE_SID&#x3D;SRM2</span><br><span class="line">[oracle@yg-test ~]$ echo $ORACLE_SID</span><br><span class="line">SRM2</span><br></pre></td></tr></table></figure>

<p><strong>2）以nomount模式启动：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[oracle@yg-test ~]$ sqlplus &#x2F; as sysdba</span><br><span class="line">SQL&gt; startup nomount pfile&#x3D;&#x2F;home&#x2F;oracle&#x2F;dup_pfile.ora;</span><br><span class="line">SQL&gt; exit</span><br></pre></td></tr></table></figure>

<p><strong>3）检查实例进程</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[oracle@yg-test ~]$ ps -ef |grep smon</span><br><span class="line">oracle   27297     1  0 01:54 ?        00:00:01 ora_smon_SRM</span><br><span class="line">oracle   46994     1  0 07:21 ?        00:00:00 ora_smon_SMR2</span><br></pre></td></tr></table></figure>

<p><strong>4）检查远程sys登录 – 注意都必须是 ： EXCLUSIVE</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[oracle@yg-test ~]$ sqlplus &#x2F; as sysdba</span><br><span class="line">SQL&gt; set line 140</span><br><span class="line">SQL&gt; show parameter remote_login_passwordfile</span><br><span class="line"></span><br><span class="line">NAME                                 TYPE                              VALUE</span><br><span class="line">------------------------------------ --------------------------------- ------------------------------</span><br><span class="line">remote_login_passwordfile            string                            EXCLUSIVE</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>5）测试source db 和 aux db 的sys远程登录,都要正常登录，不能为idle状态</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sqlplus sys&#x2F;oracle@srm as sysdba</span><br><span class="line">sqlplus sys&#x2F;oracle@srm2 as sysdba</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>6）rman登录source库</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[oracle@yg-test ~]$ rman target &#x2F;</span><br><span class="line">connected to target database: SRM (DBID&#x3D;2040369693)</span><br><span class="line"></span><br><span class="line">RMAN&gt; configure device type disk parallelism 4;</span><br><span class="line">RMAN&gt; connect auxiliary sys&#x2F;oracle@srm2</span><br><span class="line">connected to auxiliary database: SRM (not mounted)  -- 注意以后nomount启动，rman连上为 not mounted</span><br></pre></td></tr></table></figure>

<p><strong>7）开始复制 – 注意: 如果ctronl_file已经拷贝，由于其他原因再次拷贝，请先备份删除控制文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RMAN&gt; duplicate target database TO SRM2 from active database nofilenamecheck;</span><br></pre></td></tr></table></figure>

<p><strong>8）重建spfile</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; shu immediate;</span><br><span class="line">SQL&gt;  create spfile from pfile&#x3D;&#39;&#x2F;home&#x2F;oracle&#x2F;dup_pfile.ora&#39;;</span><br><span class="line">SQL&gt; startup</span><br><span class="line">SQL&gt; show parameter spfile;</span><br><span class="line">NAME                                 TYPE                              VALUE</span><br><span class="line">------------------------------------ --------------------------------- ------------------------------</span><br><span class="line">spfile                               string                            &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;11.2.0</span><br><span class="line">                                                                       &#x2F;dbhome_1&#x2F;dbs&#x2F;spfileSRM2.ora</span><br></pre></td></tr></table></figure>
<p><strong>9）校验 –查到之前数据，成功</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select * from reco;</span><br><span class="line">        ID</span><br><span class="line">----------</span><br><span class="line">         1</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/03/duplicate%E5%9F%BA%E4%BA%8Eactive%E6%BA%90%E5%BA%93%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93/" data-id="ckdegxssw0004iscs1tx3f4ul" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/duplicate/" rel="tag">duplicate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-duplicate基于源库rman备份复制数据库" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/03/duplicate%E5%9F%BA%E4%BA%8E%E6%BA%90%E5%BA%93rman%E5%A4%87%E4%BB%BD%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93/" class="article-date">
  <time datetime="2020-08-03T12:06:59.043Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/oracle/">oracle</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/03/duplicate%E5%9F%BA%E4%BA%8E%E6%BA%90%E5%BA%93rman%E5%A4%87%E4%BB%BD%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93/">duplicate db from rman backup/duplicate复制数据库</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>源库需要开启归档，不需要备份，不会影响源库（当然，一点点clone性能除外）</strong></p>
<p><em>和 from active database 不同，target可以处于关闭状态，channel使用的是 auxiliary实例的，不能配置 parallelism ，好像速度更快额，因为from active database 是先backup copy 然后在switch ，其实原理和直接拷贝rman备份恢复一样，只不过rman备份恢复更加灵活，不一定要在一个文件夹，可以指定arch文件恢复，但步骤相对较多，而这个duplicate基于rman备份复制比较简单，也是基于rman备份，先把source库恢复起来，然后在重置db_name为SRM2，注意额，rman恢复后db_name是一样的SRM，这个duplicate是复制库，db_name是SRM2不一样的，^_^</em></p>
<p><strong><em>环境信息</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">source db:</span><br><span class="line"></span><br><span class="line">sid&#x3D;SRM</span><br><span class="line">db_name &#x3D; SRM</span><br><span class="line">db_file_path &#x3D; &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM&#x2F;</span><br><span class="line">sys_pwd &#x3D; oracle</span><br><span class="line">oracle_version &#x3D; Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</span><br><span class="line">服务器资源 &#x3D; 4核4G内存40G磁盘</span><br><span class="line">OS &#x3D; CentOS Linux release 7.6.1810 (Core)</span><br></pre></td></tr></table></figure>
<p>###操作步骤<br>####1. 启动auxiliary instance</p>
<p><strong>1）. 新建静态listener – 注意 sid 区分大小写，一定要和ORACLE_SID一样</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">lsnrctl stop</span><br><span class="line">vim listener.ora</span><br><span class="line">---------------------------------------------------------------------------------------</span><br><span class="line">LISTENER&#x3D;</span><br><span class="line">  (DESCRIPTION&#x3D;</span><br><span class="line">    (ADDRESS_LIST&#x3D;</span><br><span class="line">      (ADDRESS&#x3D;(PROTOCOL&#x3D;tcp)(HOST&#x3D;localhost)(PORT&#x3D;1521))</span><br><span class="line">      (ADDRESS&#x3D;(PROTOCOL&#x3D;ipc)(KEY&#x3D;extproc))))</span><br><span class="line">SID_LIST_LISTENER&#x3D;</span><br><span class="line">  (SID_LIST&#x3D;</span><br><span class="line">    (SID_DESC&#x3D;</span><br><span class="line">      (GLOBAL_DBNAME&#x3D;SRM)</span><br><span class="line">      (ORACLE_HOME&#x3D;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;11.2.0&#x2F;dbhome_1)</span><br><span class="line">      (SID_NAME&#x3D;SRM))</span><br><span class="line">    (SID_DESC&#x3D;</span><br><span class="line">      (GLOBAL_DBNAME&#x3D;SRM2)</span><br><span class="line">      (ORACLE_HOME&#x3D;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;11.2.0&#x2F;dbhome_1)</span><br><span class="line">      (SID_NAME&#x3D;SRM2))</span><br><span class="line">  )</span><br><span class="line">---------------------------------------------------------------------------------------</span><br><span class="line">lsnrctl start</span><br><span class="line">lsnrctl status</span><br></pre></td></tr></table></figure>

<p><strong>2）增加tns</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">---------------------------------------------------------------------------------------</span><br><span class="line">SRM &#x3D;</span><br><span class="line">  (DESCRIPTION &#x3D;</span><br><span class="line">    (ADDRESS_LIST &#x3D;</span><br><span class="line">      (ADDRESS &#x3D; (PROTOCOL &#x3D; TCP)(HOST &#x3D; localhost.localdomain)(PORT &#x3D; 1521))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA &#x3D;</span><br><span class="line">      (SERVER &#x3D; DEDICATED)</span><br><span class="line">      (SERVICE_NAME &#x3D; SRM)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">SRM2 &#x3D;</span><br><span class="line">  (DESCRIPTION &#x3D;</span><br><span class="line">    (ADDRESS_LIST &#x3D;</span><br><span class="line">      (ADDRESS &#x3D; (PROTOCOL &#x3D; TCP)(HOST &#x3D; localhost.localdomain)(PORT &#x3D; 1521))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA &#x3D;</span><br><span class="line">      (SERVER &#x3D; DEDICATED)</span><br><span class="line">      (SERVICE_NAME &#x3D; SRM2)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">---------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p><strong>3）复制密码文件，或者新建</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oracle@yg-test dbs]$ cp orapwSRM orapwSRM2</span><br></pre></td></tr></table></figure>

<p>*<em>4）创建pfile并修改启动nomount, 注意: 如果自己创建pfile要加上：</em>.compatible=’11.2.0.4.0’**</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create pfile&#x3D;&#39;&#x2F;home&#x2F;oracle&#x2F;dup_pfile.ora&#39; from spfile;</span><br></pre></td></tr></table></figure>

<p><strong>5）修改dup_pfile.ora中的：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*.db_name&#x3D;&#39;SRM2&#39;</span><br><span class="line">*.audit_file_dest&#x3D;&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;admin&#x2F;SRM2&#x2F;adump&#39;</span><br><span class="line">*.control_files&#x3D;&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM2&#x2F;control01.ctl&#39;,&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM2&#x2F;control02.ctl&#39;</span><br></pre></td></tr></table></figure>

<p><strong>6）添加参数</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db_file_name_convert&#x3D;&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM&#39;,&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM2&#39;</span><br><span class="line">log_file_name_convert&#x3D;&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM&#39;,&#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM2&#39;</span><br></pre></td></tr></table></figure>

<p><strong>7）新建dup库的新文件夹：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;admin&#x2F;SRM2&#x2F;adump &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;SRM2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>####2. 准备备份<br>**1）在源库操作备份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#注意： 源库SRM的数据、归档、控制文件都要在rman一个位置下面，rman下面只能有一个db备份，auxiliary要能访问这个rman目录</span><br><span class="line">#新建备份文件夹 </span><br><span class="line">[oracle@yg-test ~]$ mkdir rman</span><br><span class="line">#备份db</span><br><span class="line">RMAN&gt; backup as compressed backupset database format &#39;&#x2F;home&#x2F;oracle&#x2F;rman&#x2F;db_%U&#39;;</span><br><span class="line">#备份归档</span><br><span class="line">RMAN&gt; backup archivelog all format &#39;&#x2F;home&#x2F;oracle&#x2F;rman&#x2F;arch_%U&#39;;</span><br><span class="line">#备份spfile</span><br><span class="line">RMAN&gt; backup spfile format &#39;&#x2F;home&#x2F;oracle&#x2F;rman&#x2F;spfile_%U&#39;;</span><br><span class="line">#备份控制文件</span><br><span class="line">RMAN&gt; backup current controlfile format &#39;&#x2F;home&#x2F;oracle&#x2F;rman&#x2F;control_%U&#39;;</span><br></pre></td></tr></table></figure>

<p>####3. 开始基于源库duplicate</p>
<p><strong>1）修改环境变量ORACLE_SID: SRM –&gt; SRM2</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[oracle@yg-test ~]$ echo $ORACLE_SID</span><br><span class="line">SRM</span><br><span class="line">[oracle@yg-test ~]$ sqlplus &#x2F; as sysdba</span><br><span class="line">SQL&gt; shu immediate;</span><br><span class="line">SQL&gt; exit</span><br><span class="line">[oracle@yg-test ~]$ export ORACLE_SID&#x3D;SRM2</span><br><span class="line">[oracle@yg-test ~]$ echo $ORACLE_SID</span><br><span class="line">SRM2</span><br></pre></td></tr></table></figure>

<p><strong>2）以nomount模式启动：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[oracle@yg-test ~]$ sqlplus &#x2F; as sysdba</span><br><span class="line">SQL&gt; startup nomount pfile&#x3D;&#x2F;home&#x2F;oracle&#x2F;dup_pfile.ora;</span><br><span class="line">SQL&gt; exit</span><br></pre></td></tr></table></figure>

<p><strong>3）检查实例进程</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[oracle@yg-test ~]$ ps -ef |grep smon    # 只有auxiliary实例在运行</span><br><span class="line">oracle   46994     1  0 07:21 ?        00:00:00 ora_smon_SMR2</span><br></pre></td></tr></table></figure>

<p><strong>4）检查远程sys登录 – 注意都必须是 ： EXCLUSIVE</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[oracle@yg-test ~]$ sqlplus &#x2F; as sysdba</span><br><span class="line">SQL&gt; set line 140</span><br><span class="line">SQL&gt; show parameter remote_login_passwordfile</span><br><span class="line"></span><br><span class="line">NAME                                 TYPE                              VALUE</span><br><span class="line">------------------------------------ --------------------------------- ------------------------------</span><br><span class="line">remote_login_passwordfile            string                            EXCLUSIVE</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>5）测试 aux db 的sys远程登录,都要正常登录，不能为idle状态</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlplus sys&#x2F;oracle@srm2 as sysdba</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>6）rman登录auxiliary库</strong>  # 注意区别，这里直接使用备份，没有登录target库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[oracle@yg-test ~]$ rman auxiliary sys&#x2F;oracle@srm2</span><br><span class="line">connected to auxiliary database: SRM (not mounted)  -- 注意以后nomount启动，rman连上为 not mounted</span><br></pre></td></tr></table></figure>

<p><strong>7）开始复制 – 注意: 如果ctronl_file已经拷贝，由于其他原因再次拷贝，请先备份删除控制文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RMAN&gt; duplicate database to SRM2 backup location &#39;&#x2F;home&#x2F;oracle&#x2F;rman&#39; nofilenamecheck;</span><br></pre></td></tr></table></figure>

<p><strong>8）重建spfile</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; shu immediate;</span><br><span class="line">SQL&gt;  create spfile from pfile&#x3D;&#39;&#x2F;home&#x2F;oracle&#x2F;dup_pfile.ora&#39;;</span><br><span class="line">SQL&gt; startup</span><br><span class="line">SQL&gt; show parameter spfile;</span><br><span class="line">NAME                                 TYPE                              VALUE</span><br><span class="line">------------------------------------ --------------------------------- ------------------------------</span><br><span class="line">spfile                               string                            &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;11.2.0</span><br><span class="line">                                                                       &#x2F;dbhome_1&#x2F;dbs&#x2F;spfileSRM2.ora</span><br></pre></td></tr></table></figure>
<p><strong>9）校验 –查到之前数据，成功</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select * from reco;</span><br><span class="line">        ID</span><br><span class="line">----------</span><br><span class="line">         1</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/03/duplicate%E5%9F%BA%E4%BA%8E%E6%BA%90%E5%BA%93rman%E5%A4%87%E4%BB%BD%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93/" data-id="ckdegxssx0005iscsfprtfa3k" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/duplicate/" rel="tag">duplicate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rman/" rel="tag">rman</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hexo_deploy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/03/hexo_deploy/" class="article-date">
  <time datetime="2020-08-03T12:06:59.043Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/centos6/">centos6</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/03/hexo_deploy/">hexo+githup 个人博客搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="闲话"><a href="#闲话" class="headerlink" title="闲话"></a>闲话</h2><p><strong>优点：</strong></p>
<ul>
<li>快速高效</li>
<li>支持markdown</li>
<li>布局自定义简单，无广告</li>
<li>部署简单</li>
</ul>
<hr>
<p><em>因为想开始写博客，但又找不到好的博客平台，平时都看博客园和开源中国看博客文章，但博客园的那个皮肤是真有点难受，所以就想自己打个博客平台用着，然后blog的话还是发表到博客园，博客园叫 姚刚，有兴趣的关注一下，以后会出一些关于运维和oracle的文章</em></p>
<hr>
<p>**本次环境：<br>个人笔记本+centos6.9 + node.js v8.9.4 + theme（NexT.Mist v5.1.4）+ githup + gitment **</p>
<blockquote>
<p>因为第一次开始搭建，主要记录一下操作步骤，可能对原理和其他分析不太全面，请原谅，有不当的或错误的见解希望指正。反正博客刚开始也没有访问量，所以就不打算购买域名，将个人博客部署到githup就好。</p>
</blockquote>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h3><p><strong>先安装git 或者node.js都行</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#直接yum进行安装、</span><br><span class="line">yum -y install git-core</span><br><span class="line">#初始化</span><br><span class="line">git config --global user.name &quot;yao gang&quot;</span><br><span class="line">git config --global user.email &quot;xxx@qq.com&quot;</span><br></pre></td></tr></table></figure>
<h3 id="安装node-js"><a href="#安装node-js" class="headerlink" title="安装node.js"></a>安装node.js</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#下载适合自己平台的进行解压：https:&#x2F;&#x2F;nodejs.org&#x2F;zh-cn&#x2F;download&#x2F;</span><br><span class="line">#我装了minimal版，下载node.js源码进行编译安装，开始报错，没有gcc g++</span><br><span class="line">yum -y install gcc gcc-c++    #注意是 gcc-c++ 而不是 g++</span><br><span class="line">#开始编译</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;node.js.8.9.4</span><br><span class="line">#报警告  WARNING: C++ compiler too old, need g++ 4.9.2 or clang++ 3.4 (CXX&#x3D;g++)</span><br><span class="line">#升级c++编译器gcc</span><br><span class="line">#下载源码包进行编译安装 https:&#x2F;&#x2F;ftp.gnu.org&#x2F;gnu&#x2F;gcc&#x2F;</span><br><span class="line">#我下载 4.9.2，因为我怕版本太高其他依赖又可能出问题</span><br><span class="line"></span><br><span class="line">wget http:&#x2F;&#x2F;gcc.skazkaforyou.com&#x2F;releases&#x2F;gcc-4.9.2&#x2F;gcc-4.9.2.tar.gz;</span><br><span class="line">tar -zxvf gcc-4.9.2.tar.gz</span><br><span class="line">cd gcc-4.9.2</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">yum install gmp-devel mpfr-devel libmpc-devel</span><br><span class="line">..&#x2F;configure --prefix&#x3D;&#x2F;usr</span><br><span class="line">make &amp;&amp; make install     # 如果期间还出现问题，小的可以忽略，但需要安装成功，否则自行百度解决</span><br><span class="line"></span><br><span class="line">#返回node.js.8.9.4目录下</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;node8.9.4</span><br><span class="line">make &amp;&amp; make install       #直到安装成功</span><br></pre></td></tr></table></figure>
<h3 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 编辑 &#x2F;etc&#x2F;profile (使用vim)</span><br><span class="line">vim &#x2F;etc&#x2F;profile</span><br><span class="line"># 在底部添加 PATH 变量</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;node8.9.4&#x2F;bin</span><br><span class="line"># 保存退出，先按exit键，再按shift+：</span><br><span class="line">wq</span><br><span class="line"># 最后保存并使其生效即可</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line"># 执行命令有输出即代表安装和环境配置成功</span><br><span class="line">node --version  #  v8.9.4</span><br></pre></td></tr></table></figure>
<h3 id="配置hexo"><a href="#配置hexo" class="headerlink" title="配置hexo"></a>配置hexo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"># 创建目录</span><br><span class="line">mkdir blog</span><br><span class="line"># 切换目录</span><br><span class="line">cd blog</span><br><span class="line"># 安装 Hexo</span><br><span class="line">npm install -g hexo-cli</span><br><span class="line"># 查看</span><br><span class="line">执行命令：  hexo version # 有输出：</span><br><span class="line">hexo-cli: 1.0.4</span><br><span class="line">os: Linux 2.6.32-696.el6.x86_64 linux x64</span><br><span class="line">http_parser: 2.7.0</span><br><span class="line">node: 8.9.4</span><br><span class="line">v8: 6.1.534.50</span><br><span class="line">uv: 1.15.0</span><br><span class="line">zlib: 1.2.11</span><br><span class="line">ares: 1.10.1-DEV</span><br><span class="line">modules: 57</span><br><span class="line">nghttp2: 1.25.0</span><br><span class="line">openssl: 1.0.2n</span><br><span class="line">icu: 59.1</span><br><span class="line">unicode: 9.0</span><br><span class="line">cldr: 31.0.1</span><br><span class="line">tz: 2017b</span><br><span class="line"></span><br><span class="line">#安装hexo 插件</span><br><span class="line">npm install hexo-generator-index --save</span><br><span class="line">npm install hexo-generator-archive --save</span><br><span class="line">npm install hexo-generator-category --save</span><br><span class="line">npm install hexo-generator-tag --save</span><br><span class="line">npm install hexo-server --save</span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line">npm install hexo-deployer-heroku --save</span><br><span class="line">npm install hexo-deployer-rsync --save</span><br><span class="line">npm install hexo-deployer-openshift --save</span><br><span class="line">npm install hexo-renderer-marked --save</span><br><span class="line">npm install hexo-renderer-stylus --save</span><br><span class="line">npm install hexo-generator-feed --save</span><br><span class="line">npm install hexo-generator-sitemap --save</span><br><span class="line">后面部署会用到 hexo-deployer-git --save，其他的好像不安装也行，我当时使用简单，并没有用到。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 初始化 Hexo</span><br><span class="line">hexo init</span><br><span class="line">ls  # 生成hexo工程： _config.yml  db.json  node_modules  package.json  package-lock.json  public  scaffolds  source  themes</span><br><span class="line"></span><br><span class="line"># _config.yml  hexo的主要配置文件 </span><br><span class="line"># db.json         hexo的文件存储，以后的博客文章文件应该就是存储在这里</span><br><span class="line"># node_modules   node的模块</span><br><span class="line"># package.json      hexo的插件</span><br><span class="line"># package-lock.json  node的相关依赖</span><br><span class="line"># public                  后面部署就是部署这里的文件</span><br><span class="line"># scaffolds             模板文件，可以编译下面的模板供后续使用,post、page 和 draft,默认是post</span><br><span class="line"># source          使用hexo命令写作的博客页面都是在这下面，可以手动拷贝到此路劲下指定位置</span><br><span class="line"># themes         hexo的主题配置文件</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里介绍几个hexo命令</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hexo init   # 在当前路劲初始化hexo博客框架工程</span><br><span class="line">hexo generate&#x2F;hexo g  # 后面是简写，讲hexo的 .md 博客文件通过 node.js 渲染生成静态页面</span><br><span class="line"> hexo deploy&#x2F;hexo d # 将生成到public下面的静态文件部署到xx&#x2F;blog&#x2F;_config.yml 指定的地方，待会我会配置为githup的一个用户名仓库，省的购买域名，需要安装git部署插件</span><br><span class="line">hexo server&#x2F;hexo s # 启动hexo服务器，访问入口http:&#x2F;&#x2F;localhost:4000（注意防火墙）</span><br><span class="line">hexo clean # 删除上面的db.json数据存储文件</span><br><span class="line">hexo d -g # 先生成，接着部署到制定位置</span><br><span class="line">hexo s -g # 先生成，接着在本地启动服务器</span><br><span class="line">hexo new &quot;我的hexo博客文章1&quot;  # 这就是博客的文章内容</span><br><span class="line">hexo new page &quot;测试页面1&quot; # hexo new page &quot;categories&quot; hexo new page &quot;categories&quot;(主要用到这2个页面，当然你可以在丰富一些，这两个页面主要是用来做博客菜单按钮的跳转页面使用的)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这部分有点杂乱，但也是为了给新手说明一下配置文件，也可以看官网文档 <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">https://hexo.io/zh-cn/docs/</a></p>
</blockquote>
<p>上面我们初始化以后，执行 hexo s -g 会在public里面按默认的post布局生成静态的html、css、js等文件，访问 localhost：4000，即可看到原生最简单的hexo主页了。ctrol + c关闭服务器。</p>
<blockquote>
<p>到这里，我们的hexo服务器已经基本完成，是不是很简单呢？如果你购买了域名的话，再设置一下喜欢的主题，就完成了。</p>
</blockquote>
<h3 id="配置github"><a href="#配置github" class="headerlink" title="配置github"></a>配置github</h3><p><em>由于我的博客没有人气，所以舍不得买域名，就把它部署到github，使用它的用户域名吧，虽然在国外，其实速度也还好啦。你可以点击<a target="_blank" rel="noopener" href="https://hd-yaogang.github.io/" title="我的博客">我的博客</a>试试，可能你要翻墙才能访问</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 首先，需要注册github，然后创建仓库，仓库名需要 重点 注意一下： 用户名 + .github.io</span><br><span class="line"># 例子：我的仓库名为： hd-yaogang.github.io 我的用户名是 ：hd-yaogang</span><br><span class="line"># 以后你的博客域名就是 xxx.github.io，我的就是 hd-yaogang.github.io</span><br><span class="line"></span><br><span class="line">#设置hexo所在服务器可以使用git免密ssh部署到 github</span><br><span class="line">#在hexo服务器生成rsa免密私钥和公钥</span><br><span class="line">ssh-keygen  -t  rsa # 一直回车即可，然后执行命令</span><br><span class="line">cat &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub # 将输出的ssh-rsa到结束的一段内容，将这段内容保存到github</span><br><span class="line"></span><br><span class="line">点进进入github仓库，再依次点击 settings--&gt;Deploy keys--&gt;add deploy key，然后随意设置key名字，将 &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub 的内容粘贴到里面，点击保存完成即可。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="部署hexo"><a href="#部署hexo" class="headerlink" title="部署hexo"></a>部署hexo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 首先测试一下git，执行命令</span><br><span class="line">mkdir git_test</span><br><span class="line">cd  git_test</span><br><span class="line">git clone git@git@github.com:hd-yaogang&#x2F;hd-yaogang.github.io.git</span><br><span class="line">默认会克隆主分支master，虽然是空的目录，但是也能验证git是否免密登录了</span><br><span class="line"></span><br><span class="line"># 编辑hexo主要配置文件</span><br><span class="line">[root@yg blog]# vim _config.yml  # 注意你所在位置</span><br><span class="line"># 找到下面，模仿着修改一下，注意type是git，注意：后面 有空格，注意配置文件的属性颜色能提示你对不对</span><br><span class="line"></span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@github.com:hd-yaogang&#x2F;hd-yaogang.github.io.git</span><br><span class="line">  branch: master</span><br><span class="line">  message: &#39;yg-blog 站点更新:&#123;&#123;now(&quot;YYYY-MM-DD HH&#x2F;mm&#x2F;ss&quot;)&#125;&#125;&#39;</span><br><span class="line"></span><br><span class="line"># 执行命令</span><br><span class="line">hexo new “我的hexo 测试博客1”</span><br><span class="line">hexo s -g # 访问http:&#x2F;&#x2F;localhost:4000</span><br><span class="line"># 然后部署到git</span><br><span class="line">hexo d -g # 访问 https:&#x2F;&#x2F;hd-yaogang.github.io ，已经显示博客了</span><br></pre></td></tr></table></figure>
<h3 id="配置hexo-theme"><a href="#配置hexo-theme" class="headerlink" title="配置hexo theme"></a>配置hexo theme</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@yg blog]# git clone --branch v5.1.2 https:&#x2F;&#x2F;github.com&#x2F;iissnan&#x2F;hexo-theme-next themes&#x2F;next</span><br><span class="line"># 下载next主题，也可以自己下载其他喜欢的，放到theme下面即可，这主题不错，后续根据自己需要再改一些</span><br><span class="line"># 启用next主题</span><br><span class="line">[root@yg blog]# vim _config.yml  # 找到theme编辑为：      theme: next</span><br><span class="line"># 重新部署</span><br><span class="line">hexo d -g # 刷新git的博客域名，多刷几次，可能有点慢，主题已经改变的很简洁。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>主题的细节设置参考，很详细了：<br><a target="_blank" rel="noopener" href="http://theme-next.iissnan.com/theme-settings.html">http://theme-next.iissnan.com/theme-settings.html</a><br><a target="_blank" rel="noopener" href="http://www.jeyzhang.com/next-theme-personal-settings.html">http://www.jeyzhang.com/next-theme-personal-settings.html</a><br><a target="_blank" rel="noopener" href="http://shenzekun.cn/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html">http://shenzekun.cn/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html</a><br><a target="_blank" rel="noopener" href="http://michael728.github.io/2015/11/30/hexo-next-optimize/">http://michael728.github.io/2015/11/30/hexo-next-optimize/</a></p>
</blockquote>
<h3 id="配置gitment"><a href="#配置gitment" class="headerlink" title="配置gitment"></a>配置gitment</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo有很多评论插件，当时也没多研究，就直接上了gitment，可能看的教程简单吧，哈哈哈，但是他评论时候需要登录githup，而且刚开始部署时，这个插件时有时无，有时你刷一下博客评论就不见了。样式的话还不错，可以看我博客评论的样子 https:&#x2F;&#x2F;hd-yaogang.github.io</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">首先到github登录，然后依次点击--&gt;账户--&gt;settings--&gt;Developer settings--&gt;New Aouth App，名字叫 Gitment ，homeURL和AuthorizationURL都填写你的域名：https:&#x2F;&#x2F;hd-yaogang.github.io，后面会生成 client ID和 Client Secret，需要配置到hexo的主题配置文件中</span><br><span class="line"></span><br><span class="line">然后创建一个空的仓库，名字是：gitment-comments</span><br><span class="line">然后编辑主题配置文件：# 修改相应的，其余的和空着的不用管</span><br><span class="line"></span><br><span class="line">gitment:</span><br><span class="line">  enable: true</span><br><span class="line">  mint: true </span><br><span class="line">  count: true </span><br><span class="line">  lazy: false</span><br><span class="line">  cleanly: false</span><br><span class="line">  language: zh-Hans # 这是指定插件为中文</span><br><span class="line">  github_user: hd-yaogang  # 这是github用户名</span><br><span class="line">  github_repo: gitment-comments  # 这是空的仓库名，用来存储评论内容</span><br><span class="line">  client_id: cc592528b859ff59a848  # 这是创建app时的id</span><br><span class="line">  client_secret: 80fe54cd8f5f7d58997cc268e376e1552c7020c7 # 这是创建app时的秘钥</span><br><span class="line">  proxy_gateway: </span><br><span class="line">  redirect_protocol: </span><br><span class="line"></span><br><span class="line"># 再次部署</span><br><span class="line">hexo  d  -g</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p><strong>由于每个人能力与想法、环境各都不同，所以可能嫌我写的差，写的啰嗦，写的不好<br>但是慢慢来，希望有错误的话帮忙指出，谢谢！</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/03/hexo_deploy/" data-id="ckdegxssy0006iscshl423j41" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/centos6/" rel="tag">centos6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/githup/" rel="tag">githup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql同机双实例简单配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/03/mysql%E5%90%8C%E6%9C%BA%E5%8F%8C%E5%AE%9E%E4%BE%8B%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2020-08-03T12:06:59.043Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="mysql-5-7-4-同机双实例简单配置"><a href="#mysql-5-7-4-同机双实例简单配置" class="headerlink" title="mysql 5.7.4 同机双实例简单配置"></a>mysql 5.7.4 同机双实例简单配置</h2><p>###安装mysql 5.7.4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep mysql|xargs -i rpm -e --nodeps &#123;&#125;</span><br><span class="line">rpm -ivh MySQL-devel-5.7.4_m14-1.el6.x86_64.rpm </span><br><span class="line">rpm -ivh MySQL-embedded-5.7.4_m14-1.el6.x86_64.rpm </span><br><span class="line">rpm -vih MySQL-server-5.7.4_m14-1.el6.x86_64.rpm </span><br><span class="line">rpm -ivh MySQL-client-5.7.4_m14-1.el6.x86_64.rpm </span><br></pre></td></tr></table></figure>

<p>###编辑/etc/my.cnf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[mysqld_multi]</span><br><span class="line">mysqld     &#x3D; &#x2F;usr&#x2F;bin&#x2F;mysqld_safe</span><br><span class="line">mysqladmin &#x3D; &#x2F;usr&#x2F;bin&#x2F;mysqladmin</span><br><span class="line">user       &#x3D; root</span><br><span class="line"> </span><br><span class="line">[mysqld1]</span><br><span class="line">port            &#x3D; 3306</span><br><span class="line">socket          &#x3D; &#x2F;tmp&#x2F;mysql.sock</span><br><span class="line">datadir         &#x3D;&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">pid-file        &#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.pid</span><br><span class="line">user            &#x3D;mysql</span><br><span class="line">lower_case_table_names&#x3D;1</span><br><span class="line"> </span><br><span class="line">log-bin         &#x3D;master-bin</span><br><span class="line">log-bin-index   &#x3D;master-bin.index</span><br><span class="line">server-id       &#x3D;1</span><br><span class="line"></span><br><span class="line">[mysqld2]</span><br><span class="line">port            &#x3D; 3307</span><br><span class="line">socket          &#x3D;&#x2F;tmp&#x2F;mysql2.sock</span><br><span class="line">datadir         &#x3D;&#x2F;var&#x2F;lib&#x2F;mysql2</span><br><span class="line">pid-file        &#x3D;&#x2F;var&#x2F;lib&#x2F;mysql2&#x2F;mysql.pid</span><br><span class="line">user            &#x3D;mysql</span><br><span class="line">lower_case_table_names&#x3D;1</span><br></pre></td></tr></table></figure>

<p>###启动 mysql1 和 mysql2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service mysql start</span><br><span class="line">mysqld_multi  start 2    # 注意，这里的2是指 &#x2F;etc&#x2F;my.cnf 中配置的[mysqld2],如果配置为[mysqld3307],则相应启动实例命令为：mysqld_multi  start 3307</span><br><span class="line">netstat -tlunp|grep mysql</span><br></pre></td></tr></table></figure>
<p><img src="data:image/png;base64,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NDY+lec3CZDA5BIQoyS55uVP2ovWa3auHSHGimzdZtvw4r3b+LjQNqdsW+UZNP7STC+lylMZCNz2pLJ0vet6Kkbjtnj59nTR+9PwnSs3m+FQOzHY/kO6Rbe765fYeCZOcTindgVSZ3E5PydaF1z7IxCfOHa7PwOITk06Gxc/BuLETrzOhzoCxC/Lrbv5PAgev56qnDpONLbqM+DRWn6U3di90jnkfHJh7O+oJz6xoV+lTGuM2hvTzkmqvUNT2Og+CNpLiTGTAAmQAAmQAAmQAAmQAAmQAAmMEgFj6F5uwR6UJV92n/VcR0JDmd8Xg73AO35DSZRFUz3CXhaa90iABEiABEiABEiABEiABEiABEiglEDEVm6l4Utumj3dZfnvZPpYosFeUva8RQIkQAIkQAIkQAIkQAIkQAIkMCgB66V90Gj88LLO3Ky9fz+xTsxpsPuFznMSIAESIAESIAESIAESIAESIIHRJeCu1995Dbhr70dX6740G94a9r7UYyASIAESIAESIAESIAESIAESIAESmE4CFdu6TScU5poESIAESIAESIAESIAESIAESIAELpoADfaLLgGmTwKxBGSXkineqSQWE+VIgARIgARIgARIgARIYFII0GCflJJkPkiABEiABEiABEiABEiABEiABCaKAA32iSpOZoYESIAESIAESIAESIAESIAESGBSCNBgn5SSZD5IgARIgARIgARIgARIgARIgAQmikDFtm6zwOEdYNFZOHv0CVgax03p/bx8ATpvJ6owmZkhE9hcBnav5BPdej6xe0DmM8ozEiABEiABEiABEiABEiCBtgnEjbCLkd55nv6NlLEuRvgacLhUzmllCUjuAE9fd/OxcxlIlr1wkfF5oQY/vah0B9c8H8MF52N/DUhWu39PZvPqNX2297Zbn7a+lMcuumX6zAPJGrBZHoR3SYAESIAESIAESIAESIAEpptAxQj7JMCZB14sADuvgYdn3Qw9fAXcWAP254GNk+51Ho0fAemQkTI+OgY6ozj7YxaQPqXfbf1b+Xb8GFNjEiABEiABEiABEiABEiCBoRP4/zHG8CiuN/l+AAAAAElFTkSuQmCC" alt="1544543587119"> </p>
<p>###初始化 mysql 1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p      # 密码在 &#x2F;root&#x2F;.mysql_secret第一个</span><br><span class="line">SET PASSWORD &#x3D; PASSWORD(&#39;xxx&#39;);  # 设置root密码</span><br><span class="line">use mysql;</span><br><span class="line">update user set password&#x3D;password(&#39;xxx&#39;) where user &#x3D; &#39;root&#39;;  # 更新root密码</span><br><span class="line">update user set host&#x3D;&#39;%&#39; where user&#x3D;&#39;root&#39;;    # 设置mysql被允许访问的主机</span><br><span class="line">flush privileges;</span><br><span class="line">quit</span><br><span class="line">#重启mysql，再登录</span><br><span class="line">service mysql restart</span><br><span class="line">mysql -uroot -p</span><br><span class="line">use mysql</span><br><span class="line">select host from user where user&#x3D;&#39;root&#39;; # 已经有了host为%,不用再更改，如果没有就更改一下</span><br><span class="line">--update user set password_expired&#x3D;&#39;N&#39; where user&#x3D;&#39;root&#39;;</span><br><span class="line">--flush privileges;</span><br><span class="line">quit</span><br><span class="line">#重启</span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>


<p>###初始化 mysql 2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql --user&#x3D;root --port&#x3D;3307 --socket&#x3D;&#x2F;tmp&#x2F;mysql2.sock -p     # 密码在 &#x2F;root&#x2F;.mysql_secret第一个</span><br><span class="line">SET PASSWORD &#x3D; PASSWORD(&#39;xxx&#39;); </span><br><span class="line">use mysql;</span><br><span class="line">update user set password&#x3D;password(&#39;xxx&#39;) where user &#x3D; &#39;root&#39;;</span><br><span class="line">update user set host&#x3D;&#39;%&#39; where user&#x3D;&#39;root&#39;;</span><br><span class="line">flush privileges;</span><br><span class="line">quit</span><br><span class="line">#重启mysql，再登录</span><br><span class="line">service mysql restart</span><br><span class="line">mysql -uroot -p</span><br><span class="line">use mysql</span><br><span class="line">select host from user where user&#x3D;&#39;root&#39;; # 已经有了host为%,不用再更改，如果没有就更改一下</span><br><span class="line">--update user set password_expired&#x3D;&#39;N&#39; where user&#x3D;&#39;root&#39;;</span><br><span class="line">--flush privileges;</span><br><span class="line">quit</span><br><span class="line"># 重启mysql2</span><br><span class="line">mysqld_multi stop 2    # 不行的话直接kill进程</span><br><span class="line">mysqld_multi start 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="同机双实例配置完毕！"><a href="#同机双实例配置完毕！" class="headerlink" title="同机双实例配置完毕！"></a>同机双实例配置完毕！</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/03/mysql%E5%90%8C%E6%9C%BA%E5%8F%8C%E5%AE%9E%E4%BE%8B%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE/" data-id="ckdegxst00009iscsclmnfc8k" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-oracle-11g-同库搭建-ogg-进阶2(GoldenGate)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/03/oracle-11g-%E5%90%8C%E5%BA%93%E6%90%AD%E5%BB%BA-ogg-%E8%BF%9B%E9%98%B62(GoldenGate)/" class="article-date">
  <time datetime="2020-08-03T12:06:59.043Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/oracle/">oracle</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/03/oracle-11g-%E5%90%8C%E5%BA%93%E6%90%AD%E5%BB%BA-ogg-%E8%BF%9B%E9%98%B62(GoldenGate)/">oracle 11g 同库搭建 ogg-进阶2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="oracle-11g-同库搭建-ogg-进阶2"><a href="#oracle-11g-同库搭建-ogg-进阶2" class="headerlink" title="oracle 11g 同库搭建 ogg-进阶2"></a>oracle 11g 同库搭建 ogg-进阶2</h1><p><u>本文为进阶2，比上一篇进阶1多了源库实施生成数据，主要做记录，其中配置若有误请见谅！！！</u></p>
<p><u>此次为了方便就同机搭建，所以mgr端口不同，如果不同机搭建，mgr端口可以一致</u></p>
<h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><table>
<thead>
<tr>
<th>name</th>
<th>version</th>
</tr>
</thead>
<tbody><tr>
<td>操作系统</td>
<td>CentOS Linux release 7.6.1810 (Core)</td>
</tr>
<tr>
<td>数据库版本</td>
<td>Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</td>
</tr>
<tr>
<td>ogg版本</td>
<td>Oracle GoldenGate Version 11.2.1.0.3 14400833 OGGCORE_11.2.1.0.3_PLATFORMS_120823.1258_FBO Linux, x64, 64bi</td>
</tr>
</tbody></table>
<hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--基本步骤</span></span><br><span class="line">1.搭建goldengate，开启mgr、extract、pump，不开启replicate</span><br><span class="line">2.查询当前scn（当前事务的最小start_time&gt;extract时间）</span><br><span class="line">3.按scn导出源库schema数据（exp/expdp）</span><br><span class="line">4.目标库导入数据</span><br><span class="line">5.检查目标trail文件中scn对应的序号和rba</span><br><span class="line">6.修改并开启rba进程</span><br><span class="line">7.检查、测试同步</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="1-新建ogg用户"><a href="#1-新建ogg用户" class="headerlink" title="1. 新建ogg用户"></a>1. 新建ogg用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">groupadd ogg</span><br><span class="line">useradd -g ogg -G oinstall,dba ogg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;oracle&quot;</span>| passwd --stdin oracle</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传oracle goldengate安装文件解压</span></span><br><span class="line">su - ogg</span><br><span class="line">rz</span><br><span class="line">mkdir sogg togg</span><br><span class="line">mkdir sogg/temp</span><br><span class="line">unzip V34339-01.zip</span><br><span class="line">tar -xf fbo_ggs_Linux_x64_ora11g_64bit.tar -C sogg/</span><br><span class="line">tar -xf fbo_ggs_Linux_x64_ora11g_64bit.tar -C togg/</span><br><span class="line"><span class="comment"># rm -f V34339-01.zip OGG_WinUnix_Rel_Notes_11.2.1.0.3.pdf  Oracle*</span></span><br></pre></td></tr></table></figure>

<h3 id="2-配置ogg环境变量"><a href="#2-配置ogg环境变量" class="headerlink" title="2. 配置ogg环境变量"></a>2. 配置ogg环境变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> TMP=/tmp</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1</span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=SRM</span><br><span class="line"><span class="built_in">export</span> PATH=/u01/app/oracle/product/11.2.0/dbhome_1/bin:/usr/sbin:/u01/app/oracle/product/11.2.0/dbhome_1/OPatch:/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/u01/app/oracle/product/11.2.0/dbhome_1/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=/u01/app/oracle/product/11.2.0/dbhome_1/JRE:/u01/app/oracle/product/11.2.0/dbhome_1/jlib:/u01/app/oracle/product/11.2.0/dbhome_1/rdbms/jlib</span><br><span class="line"><span class="built_in">export</span> NLS_LANG=AMERICAN_AMERICA.UTF8</span><br><span class="line"><span class="built_in">export</span> LC_ALL=en_US.UTF-8</span><br></pre></td></tr></table></figure>

<h3 id="3-source和target都准备"><a href="#3-source和target都准备" class="headerlink" title="3. source和target都准备"></a>3. source和target都准备</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--11.2.0.4 以上需要开启  11g一下需要执行: alter system set recyclebin=off scope=both;</span></span><br><span class="line">sqlplus / as sysdba</span><br><span class="line"><span class="keyword">set</span> lin <span class="number">200</span> pages <span class="number">30000</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> enable_goldengate_replication = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">tablespace</span> ogg_tbs <span class="keyword">datafile</span> <span class="string">&#x27;/u01/app/oracle/oradata/SRM/ogg_tbs01.dbf&#x27;</span> <span class="keyword">size</span> <span class="number">100</span>M <span class="keyword">autoextend</span> <span class="keyword">on</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> ogg <span class="keyword">identified</span> <span class="keyword">by</span> <span class="keyword">oracle</span> <span class="keyword">default</span> <span class="keyword">tablespace</span> ogg_tbs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">grant</span> dba <span class="keyword">to</span> ogg;  <span class="comment">--这里为了简单直接给dba，不然给下面权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--grant resource, connect to ogg;</span></span><br><span class="line"><span class="comment">--grant execute on utl_file to ogg;</span></span><br><span class="line"><span class="comment">--grant select any dictionary to ogg;</span></span><br><span class="line"><span class="comment">--grant select any table to ogg;</span></span><br><span class="line"><span class="comment">--grant alter any table to ogg;</span></span><br><span class="line"><span class="comment">--grant flashback any table to ogg;</span></span><br><span class="line"><span class="comment">--grant execute on dbms_flashback to ogg;</span></span><br><span class="line"><span class="comment">--grant ggs_ggsuser_role to ogg;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建测试数据用户</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> yg1 <span class="keyword">cascade</span>;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> yg2 <span class="keyword">cascade</span>;</span><br><span class="line"><span class="keyword">set</span> lin <span class="number">200</span> pages <span class="number">30000</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">tablespace</span> test_tbs <span class="keyword">datafile</span> <span class="string">&#x27;/u01/app/oracle/oradata/SRM/test_tbs01.dbf&#x27;</span> <span class="keyword">size</span> <span class="number">10</span>M <span class="keyword">autoextend</span> <span class="keyword">on</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> yg1 <span class="keyword">identified</span> <span class="keyword">by</span> <span class="keyword">oracle</span> <span class="keyword">default</span> <span class="keyword">tablespace</span> test_tbs;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> yg2 <span class="keyword">identified</span> <span class="keyword">by</span> <span class="keyword">oracle</span> <span class="keyword">default</span> <span class="keyword">tablespace</span> test_tbs;</span><br><span class="line"><span class="keyword">grant</span> dba <span class="keyword">to</span> yg1,yg2;</span><br><span class="line">conn yg1/oracle</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t1 <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> dba_tables;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t2 <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> dba_tables;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t3 (<span class="keyword">id</span> <span class="built_in">int</span>,t_date <span class="built_in">date</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--实时动态插入数据，模拟生产环境</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  job_num <span class="built_in">number</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_job.submit(</span><br><span class="line">    job =&gt; job_num,</span><br><span class="line">    what =&gt; <span class="string">&#x27;insert into t3 values(dbms_random.value*10, sysdate);&#x27;</span>, </span><br><span class="line">    next_date =&gt; <span class="keyword">sysdate</span>, </span><br><span class="line">    <span class="built_in">interval</span> =&gt;<span class="string">&#x27;sysdate+1/24/60/6&#x27;</span></span><br><span class="line">  ); </span><br><span class="line">  <span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询测试数据</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">session</span> <span class="keyword">set</span> nls_date_format=<span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> job <span class="keyword">from</span> user_jobs;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t3;</span><br><span class="line"></span><br><span class="line"><span class="comment">--开启archivelog、附加log、强制log--归档区大小设置略</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">archivelog</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">force</span> <span class="keyword">logging</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">add</span> supplemental <span class="keyword">log</span> <span class="keyword">data</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">NAME</span>,OPEN_MODE,FORCE_LOGGING,SUPPLEMENTAL_LOG_DATA_MIN <span class="keyword">from</span> v$<span class="keyword">database</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> UNDO_RETENTION = <span class="number">10800</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> OPEN_CURSORS = <span class="number">10000</span>;</span><br><span class="line"><span class="comment">--注意一定要在/home/ogg/sogg目录下执行，不然会hang住</span></span><br><span class="line">@/home/ogg/sogg/marker_setup.sql</span><br><span class="line"><span class="comment">--ogg</span></span><br><span class="line">@/home/ogg/sogg/ddl_setup.sql</span><br><span class="line"><span class="comment">--ogg</span></span><br><span class="line">@/home/ogg/sogg/role_setup.sql</span><br><span class="line"><span class="comment">--ogg</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--GRANT GGS_GGSUSER_ROLE TO ogg;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--如果出现下面这个报错执行： 先执行 @ddl_disable , 再执行 grant create table,create sequence to ogg; 最后再执行 role_setup.sql 和ddl_enable.sql ,后面如果这个ddl触发器还是报错，那还得重新marker授权</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--ORA-04098: trigger &#x27;SYS.GGS_DDL_TRIGGER_BEFORE&#x27; is invalid and failed re-validation</span></span><br><span class="line"></span><br><span class="line">@/home/ogg/sogg/ddl_enable.sql</span><br></pre></td></tr></table></figure>

<h3 id="4-创建-GoldenGate-的工作目录"><a href="#4-创建-GoldenGate-的工作目录" class="headerlink" title="4. 创建 GoldenGate 的工作目录"></a>4. 创建 GoldenGate 的工作目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/ogg/sogg/</span><br><span class="line">./ggsci</span><br><span class="line">create subdirs</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /home/ogg/togg/</span><br><span class="line">./ggsci</span><br><span class="line">create subdirs</span><br></pre></td></tr></table></figure>

<h3 id="5-源端添加checkpointtable"><a href="#5-源端添加checkpointtable" class="headerlink" title="5. 源端添加checkpointtable"></a>5. 源端添加checkpointtable</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/ogg/sogg/</span><br><span class="line">./ggsci</span><br><span class="line">EDIT PARAMS ./GLOBALS</span><br><span class="line">-----------------------------------------</span><br><span class="line">GGSCHEMA ogg</span><br><span class="line">CHECKPOINTTABLE ogg.ggschkpt1</span><br><span class="line">-----------------------------------------</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">./ggsci</span><br><span class="line">DBLOGIN USERID ogg, PASSWORD oracle</span><br><span class="line">ADD CHECKPOINTTABLE</span><br></pre></td></tr></table></figure>

<h3 id="6-目标添加checkpointtable"><a href="#6-目标添加checkpointtable" class="headerlink" title="6. 目标添加checkpointtable"></a>6. 目标添加checkpointtable</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/ogg/togg/</span><br><span class="line">./ggsci</span><br><span class="line">EDIT PARAMS ./GLOBALS</span><br><span class="line">-----------------------------------------</span><br><span class="line">GGSCHEMA ogg</span><br><span class="line">CHECKPOINTTABLE ogg.ggschkpt2</span><br><span class="line">-----------------------------------------</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">./ggsci</span><br><span class="line">DBLOGIN USERID ogg, PASSWORD oracle</span><br><span class="line">ADD CHECKPOINTTABLE</span><br></pre></td></tr></table></figure>

<h3 id="7-源配置mgr"><a href="#7-源配置mgr" class="headerlink" title="7. 源配置mgr"></a>7. 源配置mgr</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS MGR</span><br><span class="line">-----------------------------------------</span><br><span class="line">PORT 7809 </span><br><span class="line">DYNAMICPORTLIST 7800-8000</span><br><span class="line">AUTOSTART EXTRACT *</span><br><span class="line">AUTORESTART EXTRACT *,WAITMINUTES 2,RETRIES 5, RESETMINUTES 5</span><br><span class="line"></span><br><span class="line">USERID ogg, PASSWORD oracle</span><br><span class="line"></span><br><span class="line">PURGEOLDEXTRACTS /home/oracle/sogg/dirdat,USECHECKPOINTS,MINKEEPDAYS 1</span><br><span class="line">PURGEDDLHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7,FREQUENCYMINUTES 30</span><br><span class="line">PURGEMARKERHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7                                        </span><br><span class="line"></span><br><span class="line">LAGREPORTHOURS 1</span><br><span class="line">LAGINFOMINUTES 30</span><br><span class="line">LAGCRITICALMINUTES 45</span><br><span class="line">-----------------------------------------</span><br></pre></td></tr></table></figure>

<h3 id="8-目标配置mgr"><a href="#8-目标配置mgr" class="headerlink" title="8. 目标配置mgr"></a>8. 目标配置mgr</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS MGR</span><br><span class="line">-----------------------------------------</span><br><span class="line">PORT 8809 </span><br><span class="line">DYNAMICPORTLIST 8800-9000</span><br><span class="line">AUTOSTART EXTRACT *</span><br><span class="line">AUTORESTART EXTRACT *, WAITMINUTES 2, RESETMINUTES 5, RETRIES 5</span><br><span class="line"></span><br><span class="line">USERID ogg, PASSWORD oracle</span><br><span class="line"></span><br><span class="line">PURGEOLDEXTRACTS /home/ogg/togg/dirdat, USECHECKPOINTS, MINKEEPDAYS 3</span><br><span class="line">PURGEDDLHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7,FREQUENCYMINUTES 30</span><br><span class="line">PURGEMARKERHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7</span><br><span class="line"></span><br><span class="line">LAGREPORTHOURS 1</span><br><span class="line">LAGINFOMINUTES 30</span><br><span class="line">LAGCRITICALMINUTES 45</span><br><span class="line">-----------------------------------------</span><br><span class="line">start mgr</span><br><span class="line">info mgr</span><br></pre></td></tr></table></figure>

<h3 id="9-源端配置-Extract-进程"><a href="#9-源端配置-Extract-进程" class="headerlink" title="9. 源端配置 Extract 进程"></a>9. 源端配置 Extract 进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS EORA_1</span><br><span class="line">-----------------------------------------</span><br><span class="line">EXTRACT EORA_1</span><br><span class="line">SETENV (ORACLE_SID=<span class="string">&quot;SRM&quot;</span>)</span><br><span class="line">SETENV (NLS_LANG=AMERICAN_AMERICA.UTF8)</span><br><span class="line">USERID ogg, PASSWORD oracle</span><br><span class="line"></span><br><span class="line">GETTRUNCATES</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES,RATE</span><br><span class="line">NUMFILES 5000</span><br><span class="line">DISCARDROLLOVER AT 3:00</span><br><span class="line">WARNLONGTRANS 2h,CHECKINTERVAL 3m</span><br><span class="line">DYNAMICRESOLUTION</span><br><span class="line">DBOPTIONS ALLOWUNUSEDCOLUMN</span><br><span class="line">IGNOREAPPLOPS</span><br><span class="line">IGNOREREPLICATES</span><br><span class="line">FETCHOPTIONS NOUSESNAPSHOT</span><br><span class="line">FETCHOPTIONS FETCHPKUPDATECOLS</span><br><span class="line">DISCARDFILE /home/ogg/sogg/dirrpt/eora_a.dsc,APPEND,MEGABYTES 1000</span><br><span class="line">EXTTRAIL /home/ogg/sogg/dirdat/aa,MEGABYTES 100</span><br><span class="line"></span><br><span class="line">TRANLOGOPTIONS DBLOGREADER</span><br><span class="line">TRANLOGOPTIONS EXCLUDEUSER ogg</span><br><span class="line">CACHEMGR CACHEDIRECTORY /home/ogg/sogg/temp</span><br><span class="line"></span><br><span class="line">DDL INCLUDE ALL</span><br><span class="line">DDLOPTIONS ADDTRANDATA,REPORT </span><br><span class="line"></span><br><span class="line">TABLE yg1.*;</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line">ADD EXTRACT EORA_1, TRANLOG, BEGIN NOW, threads 1    <span class="comment"># 此处threads推荐等于redolog的threads</span></span><br><span class="line"></span><br><span class="line">info extract *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为捕获进程添加本地trail文件</span></span><br><span class="line">ADD EXTTRAIL /home/ogg/sogg/dirdat/aa, EXTRACT EORA_1, MEGABYTES 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 extract 进程</span></span><br><span class="line">start extract eora_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 extract 进程</span></span><br><span class="line">info eora_1</span><br></pre></td></tr></table></figure>

<h3 id="10-配置-Pump-进程"><a href="#10-配置-Pump-进程" class="headerlink" title="10. 配置 Pump 进程"></a>10. 配置 Pump 进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS PORA_1        </span><br><span class="line"><span class="comment"># 需要指定目标端的mgr端口和目标端trail文件</span></span><br><span class="line">-----------------------------------------</span><br><span class="line">EXTRACT PORA_1</span><br><span class="line">SETENV (NLS_LANG=AMERICAN_AMERICA.UTF8)</span><br><span class="line">PASSTHRU</span><br><span class="line">NUMFILES 5000</span><br><span class="line">RMTHOST yg-ocm, MGRPORT 8809,COMPRESS</span><br><span class="line">RMTTRAIL /home/ogg/togg/dirdat/pa</span><br><span class="line">DYNAMICRESOLUTION</span><br><span class="line"></span><br><span class="line">TABLE yg1.*;</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为pump传输进程指定 本地 trail 和 远程 trail文件</span></span><br><span class="line">ADD EXTRACT PORA_1, EXTTRAILSOURCE /home/ogg/sogg/dirdat/aa</span><br><span class="line">ADD RMTTRAIL /home/ogg/togg/dirdat/pa, EXTRACT PORA_1, MEGABYTES 100</span><br><span class="line"></span><br><span class="line">START EXTRACT PORA_1</span><br><span class="line">info all</span><br></pre></td></tr></table></figure>

<h3 id="11-配置目标端的-Replicat-进程"><a href="#11-配置目标端的-Replicat-进程" class="headerlink" title="11. 配置目标端的 Replicat 进程"></a>11. 配置目标端的 Replicat 进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS RORA_1</span><br><span class="line">-----------------------------------------</span><br><span class="line">REPLICAT RORA_1 </span><br><span class="line">SETENV (NLS_LANG=AMERICAN_AMERICA.UTF8)</span><br><span class="line">USERID ogg, PASSWORD oracle </span><br><span class="line">SQLEXEC <span class="string">&quot;alter session set constraints=deferred&quot;</span></span><br><span class="line">DBOPTIONS DEFERREFCONST</span><br><span class="line">GETTRUNCATES</span><br><span class="line">REPORT AT 06:00</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES,RATE</span><br><span class="line">REPORTROLLOVER AT 02:00</span><br><span class="line">REPERROR DEFAULT,ABEND</span><br><span class="line">NUMFILES 5000</span><br><span class="line">DISCARDFILE ./dirrpt/rep_a.dsc,APPEND,MEGABYTES 1024m</span><br><span class="line">DISCARDROLLOVER AT 02:00</span><br><span class="line">GROUPTRANSOPS 1000</span><br><span class="line">HANDLECOLLISIONS</span><br><span class="line">ASSUMETARGETDEFS</span><br><span class="line">ALLOWNOOPUPDATES</span><br><span class="line">DDLERROR DEFAULT IGNORE</span><br><span class="line">DDL INCLUDE MAPPED</span><br><span class="line">DDLOPTIONS REPORT</span><br><span class="line"></span><br><span class="line">MAP yg1.*, TARGET yg2.*;</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定目标端需要apply的trail文件</span></span><br><span class="line">add replicat RORA_1, exttrail /home/ogg/togg/dirdat/pa </span><br></pre></td></tr></table></figure>

<h3 id="12-源库scn数据手动导入到目标库"><a href="#12-源库scn数据手动导入到目标库" class="headerlink" title="12. 源库scn数据手动导入到目标库"></a>12. 源库scn数据手动导入到目标库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--expdp help=y</span></span><br><span class="line"><span class="comment">--impdp help=y</span></span><br><span class="line">sqlplus system/oracle</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">directory</span> expdp_dir <span class="keyword">as</span> <span class="string">&#x27;/home/oracle&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> current_scn <span class="keyword">from</span> v$<span class="keyword">database</span>;</span><br><span class="line"><span class="comment">--1732604</span></span><br><span class="line">exit</span><br><span class="line">expdp system/oracle schemas=yg1 directory=expdp_dir dumpfile=yg-test.dmp nologfile=y FLASHBACK_SCN=1732604 REUSE_DUMPFILES=y exclude=job</span><br><span class="line">sqlplus sytem/oracle</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">directory</span> impdp_dir <span class="keyword">as</span> <span class="string">&#x27;/home/oracle&#x27;</span>;</span><br><span class="line">exit</span><br><span class="line">impdp system/oracle schemas=yg1 directory=impdp_dir dumpfile=yg-test.dmp nologfile=y remap_schema=yg1:yg2</span><br></pre></td></tr></table></figure>

<h3 id="13-启动REPLICAT-RORA-1-进程"><a href="#13-启动REPLICAT-RORA-1-进程" class="headerlink" title="13. 启动REPLICAT RORA_1 进程"></a>13. 启动REPLICAT RORA_1 进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start replicat RORA_1,aftercsn 1732604</span><br><span class="line"></span><br><span class="line">info all</span><br></pre></td></tr></table></figure>

<h3 id="14-测试数据同步"><a href="#14-测试数据同步" class="headerlink" title="14. 测试数据同步"></a>14. 测试数据同步</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqlplus yg1/oracle</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t3;</span><br><span class="line"></span><br><span class="line">sqlplus yg2/oracle</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tab;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t3;</span><br></pre></td></tr></table></figure>

<p>至此，ogg-进阶2就搭建完成了，是不是复杂了很多感觉，别灰心，从前面简单的开始，慢慢来,哈哈<img src="file:///C:\Users\yaogang\AppData\Local\Temp\SGPicFaceTpBq\120192\0C19E14F.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">其中个别参数我也还没理解，我们老师上课mgr是没有加入userid参数的，但是我的purge历史数据报错，网上说是需要指定登录数据库清理历史数据，果然加上就没报错，我也不确定是不是一定需要。</span><br><span class="line">总之出问题多看 .&#x2F;ggserr.log 就行了，从简单的开始，一步一步来就行了。</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/03/oracle-11g-%E5%90%8C%E5%BA%93%E6%90%AD%E5%BB%BA-ogg-%E8%BF%9B%E9%98%B62(GoldenGate)/" data-id="ckdegxst4000eiscseibwd684" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/11g/" rel="tag">11g</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GoldenGate/" rel="tag">GoldenGate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/centos/" rel="tag">centos</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-oracle-11g-同库搭建-ogg-进阶1(GoldenGate)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/03/oracle-11g-%E5%90%8C%E5%BA%93%E6%90%AD%E5%BB%BA-ogg-%E8%BF%9B%E9%98%B61(GoldenGate)/" class="article-date">
  <time datetime="2020-08-03T12:06:59.043Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/oracle/">oracle</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/03/oracle-11g-%E5%90%8C%E5%BA%93%E6%90%AD%E5%BB%BA-ogg-%E8%BF%9B%E9%98%B61(GoldenGate)/">oracle 11g 同库搭建 ogg-进阶1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="oracle-11g-同库搭建-ogg-进阶1"><a href="#oracle-11g-同库搭建-ogg-进阶1" class="headerlink" title="oracle 11g 同库搭建 ogg-进阶1"></a>oracle 11g 同库搭建 ogg-进阶1</h1><p><u>本文为比上一篇参数稍多，主要做记录，其中配置若有误请见谅！！！</u></p>
<p><u>此次为了方便就同机搭建，所以mgr端口不同，如果不同机搭建，mgr端口可以一致</u></p>
<h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><table>
<thead>
<tr>
<th>name</th>
<th>version</th>
</tr>
</thead>
<tbody><tr>
<td>操作系统</td>
<td>CentOS Linux release 7.6.1810 (Core)</td>
</tr>
<tr>
<td>数据库版本</td>
<td>Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</td>
</tr>
<tr>
<td>ogg版本</td>
<td>Oracle GoldenGate Version 11.2.1.0.3 14400833 OGGCORE_11.2.1.0.3_PLATFORMS_120823.1258_FBO Linux, x64, 64bi</td>
</tr>
</tbody></table>
<hr>
<h3 id="1-新建ogg用户"><a href="#1-新建ogg用户" class="headerlink" title="1. 新建ogg用户"></a>1. 新建ogg用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">groupadd ogg</span><br><span class="line">useradd -g ogg -G oinstall,dba ogg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;oracle&quot;</span>| passwd --stdin oracle</span><br><span class="line"></span><br><span class="line">--上传oracle goldengate安装文件解压</span><br><span class="line">rz</span><br><span class="line">mkdir sogg togg</span><br><span class="line">mkdir sogg/temp</span><br><span class="line">unzip V34339-01.zip</span><br><span class="line">tar -xf fbo_ggs_Linux_x64_ora11g_64bit.tar -C sogg/</span><br><span class="line">tar -xf fbo_ggs_Linux_x64_ora11g_64bit.tar -C togg/</span><br><span class="line">--rm -f V34339-01.zip OGG_WinUnix_Rel_Notes_11.2.1.0.3.pdf  Oracle*</span><br></pre></td></tr></table></figure>

<h3 id="2-配置ogg环境变量"><a href="#2-配置ogg环境变量" class="headerlink" title="2. 配置ogg环境变量"></a>2. 配置ogg环境变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> TMP=/tmp</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1</span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=SRM</span><br><span class="line"><span class="built_in">export</span> PATH=/u01/app/oracle/product/11.2.0/dbhome_1/bin:/usr/sbin:/u01/app/oracle/product/11.2.0/dbhome_1/OPatch:/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/u01/app/oracle/product/11.2.0/dbhome_1/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=/u01/app/oracle/product/11.2.0/dbhome_1/JRE:/u01/app/oracle/product/11.2.0/dbhome_1/jlib:/u01/app/oracle/product/11.2.0/dbhome_1/rdbms/jlib</span><br><span class="line"><span class="built_in">export</span> NLS_LANG=AMERICAN_AMERICA.UTF8</span><br><span class="line"><span class="built_in">export</span> LC_ALL=en_US.UTF-8</span><br></pre></td></tr></table></figure>

<h3 id="3-source和target都准备数据库"><a href="#3-source和target都准备数据库" class="headerlink" title="3. source和target都准备数据库"></a>3. source和target都准备数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--11.2.0.4 以上需要开启  11g一下需要执行: alter system set recyclebin=off scope=both;</span></span><br><span class="line"><span class="keyword">set</span> lin <span class="number">200</span> pages <span class="number">30000</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> enable_goldengate_replication = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">tablespace</span> ogg_tbs <span class="keyword">datafile</span> <span class="string">&#x27;/u01/app/oracle/oradata/SRM/ogg_tbs01.dbf&#x27;</span> <span class="keyword">size</span> <span class="number">100</span>M <span class="keyword">autoextend</span> <span class="keyword">on</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> ogg <span class="keyword">identified</span> <span class="keyword">by</span> <span class="keyword">oracle</span> <span class="keyword">default</span> <span class="keyword">tablespace</span> ogg_tbs;</span><br><span class="line"><span class="keyword">grant</span> dba <span class="keyword">to</span> ogg;</span><br><span class="line"></span><br><span class="line"><span class="comment">--创建测试数据用户</span></span><br><span class="line"><span class="keyword">set</span> lin <span class="number">200</span> pages <span class="number">30000</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">tablespace</span> test_tbs <span class="keyword">datafile</span> <span class="string">&#x27;/u01/app/oracle/oradata/SRM/test_tbs01.dbf&#x27;</span> <span class="keyword">size</span> <span class="number">10</span>M <span class="keyword">autoextend</span> <span class="keyword">on</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> yg1 <span class="keyword">identified</span> <span class="keyword">by</span> <span class="keyword">oracle</span> <span class="keyword">default</span> <span class="keyword">tablespace</span> test_tbs;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> yg2 <span class="keyword">identified</span> <span class="keyword">by</span> <span class="keyword">oracle</span> <span class="keyword">default</span> <span class="keyword">tablespace</span> test_tbs;</span><br><span class="line"><span class="keyword">grant</span> dba <span class="keyword">to</span> yg1,yg2;</span><br><span class="line"></span><br><span class="line"><span class="comment">--开启archivelog、附加log、强制log</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">archivelog</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">force</span> <span class="keyword">logging</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">add</span> supplemental <span class="keyword">log</span> <span class="keyword">data</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">NAME</span>,OPEN_MODE,FORCE_LOGGING,SUPPLEMENTAL_LOG_DATA_MIN <span class="keyword">from</span> v$<span class="keyword">database</span>;</span><br><span class="line"><span class="comment">--注意一定要在/home/ogg/sogg目录下执行，不然会hang住</span></span><br><span class="line">@/home/ogg/sogg/marker_setup.sql</span><br><span class="line"><span class="comment">--ogg</span></span><br><span class="line">@/home/ogg/sogg/ddl_setup.sql</span><br><span class="line"><span class="comment">--ogg</span></span><br><span class="line">@/home/ogg/sogg/role_setup.sql</span><br><span class="line"><span class="comment">--ogg</span></span><br><span class="line"><span class="comment">--GRANT GGS_GGSUSER_ROLE TO ogg;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--如果出现下面这个报错执行： drop TRIGGER SYS.GGS_DDL_TRIGGER_BEFORE ;</span></span><br><span class="line"><span class="comment">--有时候删除也不行，需要先ddl_disable再授权，具体报错谷歌一下就行</span></span><br><span class="line"><span class="comment">--ORA-04098: trigger &#x27;SYS.GGS_DDL_TRIGGER_BEFORE&#x27; is invalid and failed re-validation</span></span><br><span class="line"></span><br><span class="line">@/home/ogg/sogg/ddl_enable.sql</span><br></pre></td></tr></table></figure>

<h3 id="4-创建-GoldenGate-的工作目录"><a href="#4-创建-GoldenGate-的工作目录" class="headerlink" title="4. 创建 GoldenGate 的工作目录"></a>4. 创建 GoldenGate 的工作目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/ogg/sogg/</span><br><span class="line">./ggsci</span><br><span class="line">create subdirs</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /home/ogg/togg/</span><br><span class="line">./ggsci</span><br><span class="line">create subdirs</span><br></pre></td></tr></table></figure>

<h3 id="5-源端添加checkpointtable"><a href="#5-源端添加checkpointtable" class="headerlink" title="5. 源端添加checkpointtable"></a>5. 源端添加checkpointtable</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/ogg/sogg/</span><br><span class="line">./ggsci</span><br><span class="line"></span><br><span class="line">EDIT PARAMS ./GLOBALS</span><br><span class="line">-----------------------------------------</span><br><span class="line">GGSCHEMA ogg</span><br><span class="line">CHECKPOINTTABLE ogg.ggschkpt1</span><br><span class="line">-----------------------------------------</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">./ggsci</span><br><span class="line">DBLOGIN USERID ogg, PASSWORD oracle</span><br><span class="line">ADD CHECKPOINTTABLE</span><br></pre></td></tr></table></figure>

<h3 id="6-目标端添加checkpointtable"><a href="#6-目标端添加checkpointtable" class="headerlink" title="6. 目标端添加checkpointtable"></a>6. 目标端添加checkpointtable</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;ogg&#x2F;togg&#x2F;</span><br><span class="line">.&#x2F;ggsci</span><br><span class="line">EDIT PARAMS .&#x2F;GLOBALS</span><br><span class="line">-----------------------------------------</span><br><span class="line">GGSCHEMA ogg</span><br><span class="line">CHECKPOINTTABLE ogg.ggschkpt2</span><br><span class="line">-----------------------------------------</span><br><span class="line">exit</span><br><span class="line">.&#x2F;ggsci</span><br><span class="line">DBLOGIN USERID ogg, PASSWORD oracle</span><br><span class="line">ADD CHECKPOINTTABLE</span><br></pre></td></tr></table></figure>

<h3 id="7-源配置mgr"><a href="#7-源配置mgr" class="headerlink" title="7. 源配置mgr"></a>7. 源配置mgr</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS MGR</span><br><span class="line">-----------------------------------------</span><br><span class="line">PORT 7809 </span><br><span class="line">DYNAMICPORTLIST 7800-8000</span><br><span class="line">AUTOSTART EXTRACT *</span><br><span class="line">AUTORESTART EXTRACT *,WAITMINUTES 2,RETRIES 5, RESETMINUTES 5</span><br><span class="line">PURGEOLDEXTRACTS /home/oracle/sogg/dirdat,USECHECKPOINTS,MINKEEPDAYS 1</span><br><span class="line">PURGEDDLHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7,FREQUENCYMINUTES 30</span><br><span class="line">PURGEMARKERHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7                                        </span><br><span class="line">-----------------------------------------</span><br><span class="line">LAGREPORTHOURS 1</span><br><span class="line">LAGINFOMINUTES 30</span><br><span class="line">LAGCRITICALMINUTES 45</span><br></pre></td></tr></table></figure>

<h3 id="8-目标配置mgr"><a href="#8-目标配置mgr" class="headerlink" title="8. 目标配置mgr"></a>8. 目标配置mgr</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS MGR</span><br><span class="line">-----------------------------------------</span><br><span class="line">PORT 8809 </span><br><span class="line">DYNAMICPORTLIST 8800-9000</span><br><span class="line">AUTOSTART EXTRACT *</span><br><span class="line">AUTORESTART EXTRACT *, WAITMINUTES 2, RESETMINUTES 5, RETRIES 5</span><br><span class="line">PURGEOLDEXTRACTS &#x2F;home&#x2F;ogg&#x2F;togg&#x2F;dirdat, USECHECKPOINTS, MINKEEPDAYS 3</span><br><span class="line">PURGEDDLHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7,FREQUENCYMINUTES 30</span><br><span class="line">PURGEMARKERHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7</span><br><span class="line"></span><br><span class="line">LAGREPORTHOURS 1</span><br><span class="line">LAGINFOMINUTES 30</span><br><span class="line">LAGCRITICALMINUTES 45</span><br><span class="line">-----------------------------------------</span><br><span class="line">start mgr</span><br><span class="line">info mgr</span><br></pre></td></tr></table></figure>

<h3 id="9-源端配置-Extract-进程"><a href="#9-源端配置-Extract-进程" class="headerlink" title="9. 源端配置 Extract 进程"></a>9. 源端配置 Extract 进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS EORA_1</span><br><span class="line">-----------------------------------------</span><br><span class="line">EXTRACT EORA_1</span><br><span class="line">SETENV (ORACLE_SID=<span class="string">&quot;SRM&quot;</span>)</span><br><span class="line">SETENV (NLS_LANG=AMERICAN_AMERICA.UTF8)</span><br><span class="line">USERID ogg, PASSWORD oracle</span><br><span class="line"></span><br><span class="line">GETTRUNCATES</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES,RATE</span><br><span class="line">NUMFILES 5000</span><br><span class="line">DISCARDROLLOVER AT 3:00</span><br><span class="line">WARNLONGTRANS 2h,CHECKINTERVAL 3m</span><br><span class="line">DYNAMICRESOLUTION</span><br><span class="line">DBOPTIONS ALLOWUNUSEDCOLUMN</span><br><span class="line">IGNOREAPPLOPS</span><br><span class="line">IGNOREREPLICATES</span><br><span class="line">FETCHOPTIONS NOUSESNAPSHOT</span><br><span class="line">FETCHOPTIONS FETCHPKUPDATECOLS</span><br><span class="line">DISCARDFILE /home/ogg/sogg/dirrpt/eora_a.dsc,APPEND,MEGABYTES 1000</span><br><span class="line">EXTTRAIL /home/ogg/sogg/dirdat/aa,MEGABYTES 100</span><br><span class="line"></span><br><span class="line">TRANLOGOPTIONS DBLOGREADER</span><br><span class="line">TRANLOGOPTIONS EXCLUDEUSER ogg</span><br><span class="line">CACHEMGR CACHEDIRECTORY /home/ogg/sogg/temp</span><br><span class="line"></span><br><span class="line">DDL INCLUDE ALL</span><br><span class="line">DDLOPTIONS ADDTRANDATA,REPORT </span><br><span class="line"></span><br><span class="line">TABLE yg1.*;</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line">ADD EXTRACT EORA_1, TRANLOG, BEGIN NOW, threads 1</span><br><span class="line"></span><br><span class="line">info extract *</span><br><span class="line"></span><br><span class="line">ADD EXTTRAIL /home/ogg/sogg/dirdat/aa, EXTRACT EORA_1, MEGABYTES 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 extract 进程</span></span><br><span class="line">start extract eora_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 extract 进程</span></span><br><span class="line">info eora_1</span><br></pre></td></tr></table></figure>

<h3 id="10-配置-Pump-进程"><a href="#10-配置-Pump-进程" class="headerlink" title="10. 配置 Pump 进程"></a>10. 配置 Pump 进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS PORA_1</span><br><span class="line">-----------------------------------------</span><br><span class="line">EXTRACT PORA_1</span><br><span class="line">SETENV (NLS_LANG=AMERICAN_AMERICA.UTF8)</span><br><span class="line">PASSTHRU</span><br><span class="line">NUMFILES 5000</span><br><span class="line">RMTHOST yg-ocm, MGRPORT 8809,COMPRESS</span><br><span class="line">RMTTRAIL /home/ogg/togg/dirdat/pa</span><br><span class="line">DYNAMICRESOLUTION</span><br><span class="line"></span><br><span class="line">TABLE yg1.*;</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为pump进程指定 本地trail 和 远程trail文件</span></span><br><span class="line">ADD EXTRACT PORA_1, EXTTRAILSOURCE /home/ogg/sogg/dirdat/aa</span><br><span class="line">ADD RMTTRAIL /home/ogg/togg/dirdat/pa, EXTRACT PORA_1, MEGABYTES 100</span><br><span class="line"></span><br><span class="line">START EXTRACT PORA_1</span><br><span class="line">info all</span><br></pre></td></tr></table></figure>

<h3 id="11-配置目标端的-Replicat-进程"><a href="#11-配置目标端的-Replicat-进程" class="headerlink" title="11. 配置目标端的 Replicat 进程"></a>11. 配置目标端的 Replicat 进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS RORA_1</span><br><span class="line">-----------------------------------------</span><br><span class="line">REPLICAT RORA_1 </span><br><span class="line">SETENV (NLS_LANG=AMERICAN_AMERICA.UTF8)</span><br><span class="line">USERID ogg, PASSWORD oracle </span><br><span class="line">SQLEXEC <span class="string">&quot;alter session set constraints=deferred&quot;</span></span><br><span class="line">DBOPTIONS DEFERREFCONST</span><br><span class="line">GETTRUNCATES</span><br><span class="line">REPORT AT 06:00</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES,RATE</span><br><span class="line">REPORTROLLOVER AT 02:00</span><br><span class="line">REPERROR DEFAULT,ABEND</span><br><span class="line">NUMFILES 5000</span><br><span class="line">DISCARDFILE ./dirrpt/rep_a.dsc,APPEND,MEGABYTES 1024m</span><br><span class="line">DISCARDROLLOVER AT 02:00</span><br><span class="line">GROUPTRANSOPS 1000</span><br><span class="line">HANDLECOLLISIONS</span><br><span class="line">ASSUMETARGETDEFS</span><br><span class="line">ALLOWNOOPUPDATES</span><br><span class="line">DDLERROR DEFAULT IGNORE</span><br><span class="line">DDL INCLUDE MAPPED</span><br><span class="line">DDLOPTIONS REPORT</span><br><span class="line"></span><br><span class="line">MAP yg1.*, TARGET yg2.*;</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line">add replicat RORA_1, exttrail /home/ogg/togg/dirdat/pa </span><br><span class="line"></span><br><span class="line">start REPLICAT RORA_1</span><br><span class="line"></span><br><span class="line">info all</span><br></pre></td></tr></table></figure>

<h3 id="12-测试数据同步"><a href="#12-测试数据同步" class="headerlink" title="12. 测试数据同步"></a>12. 测试数据同步</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlplus yg1/oracle</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line">sqlplus yg2/oracle</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t;</span><br></pre></td></tr></table></figure>

<p>至此，ogg-进阶1就搭建完成了，比简单的参数复杂了一些，但还是没有导入导出数据，仅仅只是做到了2个用户的数据同步，哈哈<img src="file:///C:\Users\yaogang\AppData\Local\Temp\SGPicFaceTpBq\120192\0C19E14F.png" alt="img"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/03/oracle-11g-%E5%90%8C%E5%BA%93%E6%90%AD%E5%BB%BA-ogg-%E8%BF%9B%E9%98%B61(GoldenGate)/" data-id="ckdegxst5000giscsbvoygov5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/11g/" rel="tag">11g</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GoldenGate/" rel="tag">GoldenGate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/centos/" rel="tag">centos</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-oracle_11g_同库搭建ogg测试(GoldenGate)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/03/oracle_11g_%E5%90%8C%E5%BA%93%E6%90%AD%E5%BB%BAogg%E6%B5%8B%E8%AF%95(GoldenGate)/" class="article-date">
  <time datetime="2020-08-03T12:06:59.043Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/oracle/">oracle</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/03/oracle_11g_%E5%90%8C%E5%BA%93%E6%90%AD%E5%BB%BAogg%E6%B5%8B%E8%AF%95(GoldenGate)/">oracle 11g 同库搭建ogg测试(GoldenGate)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="oracle-11g-同库搭建ogg测试-GoldenGate"><a href="#oracle-11g-同库搭建ogg测试-GoldenGate" class="headerlink" title="oracle 11g 同库搭建ogg测试(GoldenGate)"></a>oracle 11g 同库搭建ogg测试(GoldenGate)</h1><p><u>关于dg和ogg的优缺点就不说了，自己了解。第一次照着老师的做还是有一定的难度，参数比较多不理解，期间还涉及scn，搞很久搞不定，后面照着网上简单博客来，循序渐进练习，本文为很简单的入门数据同步，主要做记录，其中配置若有误请见谅！！！</u></p>
<p><u>此次为了方便就同机搭建，所以mgr端口不同，如果不同机搭建，mgr端口可以一致</u></p>
<h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><table>
<thead>
<tr>
<th>name</th>
<th>version</th>
</tr>
</thead>
<tbody><tr>
<td>操作系统</td>
<td>CentOS Linux release 7.6.1810 (Core)</td>
</tr>
<tr>
<td>数据库版本</td>
<td>Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</td>
</tr>
<tr>
<td>ogg版本</td>
<td>Oracle GoldenGate Version 11.2.1.0.3 14400833 OGGCORE_11.2.1.0.3_PLATFORMS_120823.1258_FBO Linux, x64, 64bi</td>
</tr>
</tbody></table>
<hr>
<h3 id="1-新建ogg用户"><a href="#1-新建ogg用户" class="headerlink" title="1. 新建ogg用户"></a>1. 新建ogg用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">groupadd ogg</span><br><span class="line">useradd -g ogg -G oinstall,dba ogg</span><br><span class="line">echo &quot;oracle&quot;| passwd <span class="comment">--stdin oracle</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--上传oracle goldengate安装文件解压</span></span><br><span class="line">rz</span><br><span class="line">mkdir sogg togg</span><br><span class="line">mkdir sogg/temp</span><br><span class="line">unzip V34339-01.zip</span><br><span class="line">tar -xf fbo_ggs_Linux_x64_ora11g_64bit.tar -C sogg/</span><br><span class="line">tar -xf fbo_ggs_Linux_x64_ora11g_64bit.tar -C togg/</span><br><span class="line"><span class="comment">--rm -f V34339-01.zip OGG_WinUnix_Rel_Notes_11.2.1.0.3.pdf  Oracle*</span></span><br></pre></td></tr></table></figure>

<h3 id="2-配置ogg环境变量"><a href="#2-配置ogg环境变量" class="headerlink" title="2. 配置ogg环境变量"></a>2. 配置ogg环境变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意，此次同机就一个用户，如果是双机的话2个系统都要创建用户和配置环境变量</span></span><br><span class="line"><span class="built_in">export</span> TMP=/tmp</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1</span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=SRM</span><br><span class="line"><span class="built_in">export</span> PATH=/u01/app/oracle/product/11.2.0/dbhome_1/bin:/usr/sbin:/u01/app/oracle/product/11.2.0/dbhome_1/OPatch:/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/u01/app/oracle/product/11.2.0/dbhome_1/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=/u01/app/oracle/product/11.2.0/dbhome_1/JRE:/u01/app/oracle/product/11.2.0/dbhome_1/jlib:/u01/app/oracle/product/11.2.0/dbhome_1/rdbms/jlib</span><br><span class="line"><span class="built_in">export</span> NLS_LANG=AMERICAN_AMERICA.UTF8</span><br></pre></td></tr></table></figure>

<h3 id="3-source和target都准备"><a href="#3-source和target都准备" class="headerlink" title="3. source和target都准备"></a>3. source和target都准备</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--11.2.0.4 以上需要开启  11g一下需要执行: alter system set recyclebin=off scope=both;</span></span><br><span class="line"><span class="keyword">set</span> lin <span class="number">200</span> pages <span class="number">30000</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> enable_goldengate_replication = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">tablespace</span> ogg_tbs <span class="keyword">datafile</span> <span class="string">&#x27;/u01/app/oracle/oradata/SRM/ogg_tbs01.dbf&#x27;</span> <span class="keyword">size</span> <span class="number">100</span>M <span class="keyword">autoextend</span> <span class="keyword">on</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> ogg <span class="keyword">identified</span> <span class="keyword">by</span> <span class="keyword">oracle</span> <span class="keyword">default</span> <span class="keyword">tablespace</span> ogg_tbs;</span><br><span class="line"><span class="keyword">grant</span> dba <span class="keyword">to</span> ogg;</span><br><span class="line"></span><br><span class="line"><span class="comment">--创建测试数据用户</span></span><br><span class="line"><span class="keyword">set</span> lin <span class="number">200</span> pages <span class="number">30000</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">tablespace</span> test_tbs <span class="keyword">datafile</span> <span class="string">&#x27;/u01/app/oracle/oradata/SRM/test_tbs01.dbf&#x27;</span> <span class="keyword">size</span> <span class="number">10</span>M <span class="keyword">autoextend</span> <span class="keyword">on</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> yg1 <span class="keyword">identified</span> <span class="keyword">by</span> <span class="keyword">oracle</span> <span class="keyword">default</span> <span class="keyword">tablespace</span> test_tbs;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> yg2 <span class="keyword">identified</span> <span class="keyword">by</span> <span class="keyword">oracle</span> <span class="keyword">default</span> <span class="keyword">tablespace</span> test_tbs;</span><br><span class="line"><span class="keyword">grant</span> dba <span class="keyword">to</span> yg1,yg2;</span><br><span class="line"></span><br><span class="line"><span class="comment">--开启archivelog、附加log、强制log</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">archivelog</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">force</span> <span class="keyword">logging</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">add</span> supplemental <span class="keyword">log</span> <span class="keyword">data</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">NAME</span>,OPEN_MODE,FORCE_LOGGING,SUPPLEMENTAL_LOG_DATA_MIN <span class="keyword">from</span> v$<span class="keyword">database</span>;</span><br><span class="line"><span class="comment">--注意一定要在/home/ogg/sogg目录下执行，不然会hang住</span></span><br><span class="line">@/home/ogg/sogg/marker_setup.sql</span><br><span class="line"><span class="comment">--ogg</span></span><br><span class="line">@/home/ogg/sogg/ddl_setup.sql</span><br><span class="line"><span class="comment">--ogg</span></span><br><span class="line">@/home/ogg/sogg/role_setup.sql</span><br><span class="line"><span class="comment">--ogg</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--GRANT GGS_GGSUSER_ROLE TO ogg;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--如果出现下面这个报错执行： drop TRIGGER SYS.GGS_DDL_TRIGGER_BEFORE ;</span></span><br><span class="line"><span class="comment">--有时候删除也不行，需要先ddl_disable再授权，具体报错谷歌一下就行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--ORA-04098: trigger &#x27;SYS.GGS_DDL_TRIGGER_BEFORE&#x27; is invalid and failed re-validation</span></span><br><span class="line"></span><br><span class="line">@/home/ogg/sogg/ddl_enable.sql</span><br></pre></td></tr></table></figure>

<h3 id="4-创建-GoldenGate-的工作目录"><a href="#4-创建-GoldenGate-的工作目录" class="headerlink" title="4. 创建 GoldenGate 的工作目录"></a>4. 创建 GoldenGate 的工作目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意 ogg 的参数配置文件中不能加 # 作为注释行</span></span><br><span class="line"><span class="built_in">cd</span> /home/ogg/sogg/</span><br><span class="line">./ggsci</span><br><span class="line">create subdirs</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /home/ogg/togg/</span><br><span class="line">./ggsci</span><br><span class="line">create subdirs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 源端添加checkpointtable</span></span><br><span class="line"><span class="built_in">cd</span> /home/ogg/sogg/</span><br><span class="line">./ggsci</span><br><span class="line"></span><br><span class="line">EDIT PARAMS ./GLOBALS</span><br><span class="line">-----------------------------------------</span><br><span class="line">GGSCHEMA ogg</span><br><span class="line">CHECKPOINTTABLE ogg.ggschkpt1</span><br><span class="line">-----------------------------------------</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">./ggsci</span><br><span class="line">DBLOGIN USERID ogg, PASSWORD oracle</span><br><span class="line">ADD CHECKPOINTTABLE</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标源端添加checkpointtable</span></span><br><span class="line"><span class="built_in">cd</span> /home/ogg/togg/</span><br><span class="line">./ggsci</span><br><span class="line">EDIT PARAMS ./GLOBALS</span><br><span class="line">-----------------------------------------</span><br><span class="line">GGSCHEMA ogg</span><br><span class="line">CHECKPOINTTABLE ogg.ggschkpt2</span><br><span class="line">-----------------------------------------</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">./ggsci</span><br><span class="line">DBLOGIN USERID ogg, PASSWORD oracle</span><br><span class="line">ADD CHECKPOINTTABLE</span><br></pre></td></tr></table></figure>

<h3 id="5-源配置mgr"><a href="#5-源配置mgr" class="headerlink" title="5. 源配置mgr"></a>5. 源配置mgr</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS MGR</span><br><span class="line">-----------------------------------------</span><br><span class="line">PORT 7809 </span><br><span class="line">DYNAMICPORTLIST 7800-8000</span><br><span class="line">AUTOSTART EXTRACT *</span><br><span class="line">AUTORESTART EXTRACT *,WAITMINUTES 2,RETRIES 5, RESETMINUTES 5</span><br><span class="line">PURGEOLDEXTRACTS /home/oracle/sogg/dirdat,USECHECKPOINTS,MINKEEPDAYS 1</span><br><span class="line">PURGEDDLHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7,FREQUENCYMINUTES 30</span><br><span class="line">PURGEMARKERHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7                                        </span><br><span class="line"></span><br><span class="line">LAGREPORTHOURS 1</span><br><span class="line">LAGINFOMINUTES 30</span><br><span class="line">LAGCRITICALMINUTES 45</span><br><span class="line">-----------------------------------------</span><br></pre></td></tr></table></figure>

<h3 id="6-目标配置mgr"><a href="#6-目标配置mgr" class="headerlink" title="6. 目标配置mgr"></a>6. 目标配置mgr</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS MGR</span><br><span class="line">-----------------------------------------</span><br><span class="line">PORT 8809 </span><br><span class="line">DYNAMICPORTLIST 8800-9000</span><br><span class="line">AUTOSTART EXTRACT *</span><br><span class="line">AUTORESTART EXTRACT *, WAITMINUTES 2, RESETMINUTES 5, RETRIES 5</span><br><span class="line">PURGEOLDEXTRACTS /home/ogg/togg/dirdat, USECHECKPOINTS, MINKEEPDAYS 3</span><br><span class="line">PURGEDDLHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7,FREQUENCYMINUTES 30</span><br><span class="line">PURGEMARKERHISTORY MINKEEPDAYS 3,MAXKEEPDAYS 7</span><br><span class="line"></span><br><span class="line">LAGREPORTHOURS 1</span><br><span class="line">LAGINFOMINUTES 30</span><br><span class="line">LAGCRITICALMINUTES 45</span><br><span class="line">-----------------------------------------</span><br><span class="line">start mgr</span><br><span class="line">info mgr</span><br></pre></td></tr></table></figure>

<h3 id="7-源端配置-Extract-进程"><a href="#7-源端配置-Extract-进程" class="headerlink" title="7. 源端配置 Extract 进程"></a>7. 源端配置 Extract 进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS EORA_1</span><br><span class="line">-----------------------------------------</span><br><span class="line">EXTRACT EORA_1</span><br><span class="line">SETENV (ORACLE_SID=<span class="string">&quot;SRM&quot;</span>)</span><br><span class="line">SETENV (NLS_LANG=AMERICAN_AMERICA.UTF8)</span><br><span class="line">USERID ogg, PASSWORD oracle</span><br><span class="line"></span><br><span class="line">GETTRUNCATES</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES,RATE</span><br><span class="line">NUMFILES 5000</span><br><span class="line">DISCARDROLLOVER AT 3:00</span><br><span class="line">WARNLONGTRANS 2h,CHECKINTERVAL 3m</span><br><span class="line">DYNAMICRESOLUTION</span><br><span class="line">DBOPTIONS ALLOWUNUSEDCOLUMN</span><br><span class="line">IGNOREAPPLOPS</span><br><span class="line">IGNOREREPLICATES</span><br><span class="line">FETCHOPTIONS NOUSESNAPSHOT</span><br><span class="line">FETCHOPTIONS FETCHPKUPDATECOLS</span><br><span class="line">DISCARDFILE /home/ogg/sogg/dirrpt/eora_a.dsc,APPEND,MEGABYTES 1000</span><br><span class="line">EXTTRAIL /home/ogg/sogg/dirdat/aa,MEGABYTES 100</span><br><span class="line"></span><br><span class="line">TRANLOGOPTIONS DBLOGREADER</span><br><span class="line">TRANLOGOPTIONS EXCLUDEUSER ogg</span><br><span class="line">CACHEMGR CACHEDIRECTORY /home/ogg/sogg/temp</span><br><span class="line"></span><br><span class="line">DDL INCLUDE ALL</span><br><span class="line">DDLOPTIONS ADDTRANDATA,REPORT </span><br><span class="line">TABLE yg1.*;</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line">ADD EXTRACT EORA_1, TRANLOG, BEGIN NOW, threads 1</span><br><span class="line"></span><br><span class="line">info extract *</span><br><span class="line"></span><br><span class="line">ADD EXTTRAIL /home/ogg/sogg/dirdat/aa, EXTRACT EORA_1, MEGABYTES 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 extract 进程</span></span><br><span class="line">start extract eora_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 extract 进程</span></span><br><span class="line">info eora_1</span><br></pre></td></tr></table></figure>

<h3 id="8-配置-Pump-进程"><a href="#8-配置-Pump-进程" class="headerlink" title="8. 配置 Pump 进程"></a>8. 配置 Pump 进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS PORA_1</span><br><span class="line">-----------------------------------------</span><br><span class="line">EXTRACT PORA_1</span><br><span class="line">SETENV (NLS_LANG=AMERICAN_AMERICA.UTF8)</span><br><span class="line">PASSTHRU</span><br><span class="line">NUMFILES 5000</span><br><span class="line">RMTHOST yg-ocm, MGRPORT 8809,COMPRESS</span><br><span class="line">RMTTRAIL /home/ogg/togg/dirdat/pa</span><br><span class="line">DYNAMICRESOLUTION</span><br><span class="line"></span><br><span class="line">TABLE yg1.*;</span><br><span class="line">-----------------------------------------</span><br><span class="line"><span class="comment"># 为pump进程指定 本地trail 和 远程trail文件</span></span><br><span class="line">ADD EXTRACT PORA_1, EXTTRAILSOURCE /home/ogg/sogg/dirdat/aa</span><br><span class="line">ADD RMTTRAIL /home/ogg/togg/dirdat/pa, EXTRACT PORA_1, MEGABYTES 100</span><br><span class="line"></span><br><span class="line">START EXTRACT PORA_1</span><br><span class="line">info all</span><br></pre></td></tr></table></figure>

<h3 id="9-配置目标端的-Replicat-进程"><a href="#9-配置目标端的-Replicat-进程" class="headerlink" title="9. 配置目标端的 Replicat 进程"></a>9. 配置目标端的 Replicat 进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">EDIT PARAMS RORA_1</span><br><span class="line">-----------------------------------------</span><br><span class="line">REPLICAT RORA_1 </span><br><span class="line">SETENV (NLS_LANG=AMERICAN_AMERICA.UTF8)</span><br><span class="line">USERID ogg, PASSWORD oracle </span><br><span class="line">SQLEXEC <span class="string">&quot;alter session set constraints=deferred&quot;</span></span><br><span class="line">DBOPTIONS DEFERREFCONST</span><br><span class="line">GETTRUNCATES</span><br><span class="line">REPORT AT 06:00</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES,RATE</span><br><span class="line">REPORTROLLOVER AT 02:00</span><br><span class="line">REPERROR DEFAULT,ABEND</span><br><span class="line">NUMFILES 5000</span><br><span class="line">DISCARDFILE ./dirrpt/rep_a.dsc,APPEND,MEGABYTES 1024m</span><br><span class="line">DISCARDROLLOVER AT 02:00</span><br><span class="line">GROUPTRANSOPS 1000</span><br><span class="line">HANDLECOLLISIONS</span><br><span class="line">ASSUMETARGETDEFS</span><br><span class="line">ALLOWNOOPUPDATES</span><br><span class="line">DDLERROR DEFAULT IGNORE</span><br><span class="line">DDL INCLUDE MAPPED</span><br><span class="line">DDLOPTIONS REPORT</span><br><span class="line"></span><br><span class="line">MAP yg1.*, TARGET yg2.*;</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line">add replicat RORA_1, exttrail /home/ogg/togg/dirdat/pa </span><br><span class="line"></span><br><span class="line">start REPLICAT RORA_1</span><br><span class="line"></span><br><span class="line">info all</span><br></pre></td></tr></table></figure>

<h3 id="9-测试数据同步"><a href="#9-测试数据同步" class="headerlink" title="9. 测试数据同步"></a>9. 测试数据同步</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlplus yg1/oracle</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line">sqlplus yg2/oracle</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t;</span><br></pre></td></tr></table></figure>

<p><strong>至此，最简单的ogg就搭建完成了，其中没有复杂优化的参数，没有导入导出数据，仅仅只是做到了2个用户的数据同步，哈哈!</strong></p>
<hr>
<p><strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lottu/p/9542681.html">参考博文</a>: <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lottu/p/9542681.html">https://www.cnblogs.com/lottu/p/9542681.html</a></strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/03/oracle_11g_%E5%90%8C%E5%BA%93%E6%90%AD%E5%BB%BAogg%E6%B5%8B%E8%AF%95(GoldenGate)/" data-id="ckdegxst9000miscs258a3xgu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/11g/" rel="tag">11g</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GoldenGate/" rel="tag">GoldenGate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/centos/" rel="tag">centos</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/centos6/">centos6</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/oracle/">oracle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/oracle-12c-rac/">oracle 12c rac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/oracle12c/">oracle12c</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/postgrepsql/">postgrepsql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/windows/">windows</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/11g/" rel="tag">11g</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GoldenGate/" rel="tag">GoldenGate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bios/" rel="tag">bios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/block/" rel="tag">block</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/broker/" rel="tag">broker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cas/" rel="tag">cas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/" rel="tag">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos6/" rel="tag">centos6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clone/" rel="tag">clone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/data-guard/" rel="tag">data guard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/database/" rel="tag">database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/duplicate/" rel="tag">duplicate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/event/" rel="tag">event</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flashback/" rel="tag">flashback</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/githup/" rel="tag">githup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/incarnation/" rel="tag">incarnation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oracle12c/" rel="tag">oracle12c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pdb/" rel="tag">pdb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pg10/" rel="tag">pg10</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgrepsql/" rel="tag">postgrepsql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rac/" rel="tag">rac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/refresh/" rel="tag">refresh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rman/" rel="tag">rman</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql-trace/" rel="tag">sql_trace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unison/" rel="tag">unison</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%BB%E6%9D%BF/" rel="tag">主板</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86/" rel="tag">正向代理</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/11g/" style="font-size: 15px;">11g</a> <a href="/tags/GoldenGate/" style="font-size: 15px;">GoldenGate</a> <a href="/tags/bios/" style="font-size: 10px;">bios</a> <a href="/tags/block/" style="font-size: 10px;">block</a> <a href="/tags/broker/" style="font-size: 10px;">broker</a> <a href="/tags/cas/" style="font-size: 10px;">cas</a> <a href="/tags/centos/" style="font-size: 15px;">centos</a> <a href="/tags/centos6/" style="font-size: 17.5px;">centos6</a> <a href="/tags/clone/" style="font-size: 10px;">clone</a> <a href="/tags/data-guard/" style="font-size: 12.5px;">data guard</a> <a href="/tags/database/" style="font-size: 10px;">database</a> <a href="/tags/duplicate/" style="font-size: 15px;">duplicate</a> <a href="/tags/event/" style="font-size: 10px;">event</a> <a href="/tags/flashback/" style="font-size: 10px;">flashback</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/githup/" style="font-size: 10px;">githup</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/incarnation/" style="font-size: 10px;">incarnation</a> <a href="/tags/linux/" style="font-size: 12.5px;">linux</a> <a href="/tags/oracle/" style="font-size: 20px;">oracle</a> <a href="/tags/oracle12c/" style="font-size: 10px;">oracle12c</a> <a href="/tags/pdb/" style="font-size: 10px;">pdb</a> <a href="/tags/pg10/" style="font-size: 10px;">pg10</a> <a href="/tags/postgrepsql/" style="font-size: 10px;">postgrepsql</a> <a href="/tags/rac/" style="font-size: 10px;">rac</a> <a href="/tags/refresh/" style="font-size: 10px;">refresh</a> <a href="/tags/rman/" style="font-size: 12.5px;">rman</a> <a href="/tags/sql-trace/" style="font-size: 10px;">sql_trace</a> <a href="/tags/unison/" style="font-size: 10px;">unison</a> <a href="/tags/%E4%B8%BB%E6%9D%BF/" style="font-size: 10px;">主板</a> <a href="/tags/%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86/" style="font-size: 10px;">正向代理</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/08/03/postgresql-%E5%90%8C%E6%9C%BA%E7%89%A9%E7%90%86%E5%BC%82%E6%AD%A5%E4%B8%BB%E5%A4%87%E5%BA%93%E6%90%AD%E5%BB%BA/">postgresql-同机物理异步主备库搭建</a>
          </li>
        
          <li>
            <a href="/2020/08/03/12.2.0_RAC_ORACLE_HOME_chmod%E5%92%8Cchown%E6%83%A8%E6%A1%88%E6%81%A2%E5%A4%8D%E4%B8%80%E4%BE%8B/">12.2.0 RAC ORACLE_HOME chmod/chown惨案恢复一例</a>
          </li>
        
          <li>
            <a href="/2020/08/03/data_guard_broker_%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/">data guard broker 简单使用</a>
          </li>
        
          <li>
            <a href="/2020/08/03/duplicate%E5%9F%BA%E4%BA%8Eactive%E6%BA%90%E5%BA%93%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93/">duplicate db from active database/duplicate复制数据库</a>
          </li>
        
          <li>
            <a href="/2020/08/03/duplicate%E5%9F%BA%E4%BA%8E%E6%BA%90%E5%BA%93rman%E5%A4%87%E4%BB%BD%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93/">duplicate db from rman backup/duplicate复制数据库</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 姚刚<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>