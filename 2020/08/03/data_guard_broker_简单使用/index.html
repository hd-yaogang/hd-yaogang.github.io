<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>data guard broker 简单使用 | 自律自由</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="data guard broker 简单使用 前提: 需要提前搭建好data guard (如果还未搭建，可参考我duplicate建dg，比较简单)  环境信息  配置主库的dg broker静态监听  LISTENER&#x3D;    (DESCRIPTION&#x3D;      (ADDRESS_LIST&#x3D;        (ADDRESS&#x3D;(PROTOCOL&#x3D;tcp)(HOST&#x3D;192.168.100.20">
<meta property="og:type" content="article">
<meta property="og:title" content="data guard broker 简单使用">
<meta property="og:url" content="http://yoursite.com/2020/08/03/data_guard_broker_%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="自律自由">
<meta property="og:description" content="data guard broker 简单使用 前提: 需要提前搭建好data guard (如果还未搭建，可参考我duplicate建dg，比较简单)  环境信息  配置主库的dg broker静态监听  LISTENER&#x3D;    (DESCRIPTION&#x3D;      (ADDRESS_LIST&#x3D;        (ADDRESS&#x3D;(PROTOCOL&#x3D;tcp)(HOST&#x3D;192.168.100.20">
<meta property="og:locale">
<meta property="article:published_time" content="2020-08-03T12:06:59.043Z">
<meta property="article:modified_time" content="2020-08-03T12:06:59.043Z">
<meta property="article:author" content="姚刚">
<meta property="article:tag" content="oracle">
<meta property="article:tag" content="data guard">
<meta property="article:tag" content="broker">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="自律自由" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">自律自由</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-data_guard_broker_简单使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/03/data_guard_broker_%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2020-08-03T12:06:59.043Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/oracle/">oracle</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      data guard broker 简单使用
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="data-guard-broker-简单使用"><a href="#data-guard-broker-简单使用" class="headerlink" title="data guard broker 简单使用"></a>data guard broker 简单使用</h1><blockquote>
<p><strong>前提: 需要提前搭建好data guard (如果还未搭建，可参考我duplicate建dg，比较简单)</strong></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.notion.so/8c29b9439ae645278ea7825fd3586a45">环境信息</a></p>
<ol>
<li><p><strong>配置主库的dg broker静态监听</strong></p>
<pre><code> LISTENER=
   (DESCRIPTION=
     (ADDRESS_LIST=
       (ADDRESS=(PROTOCOL=tcp)(HOST=192.168.100.203)(PORT=1521))
       (ADDRESS=(PROTOCOL=ipc)(KEY=extproc))))
 SID_LIST_LISTENER=
   (SID_LIST=
     (SID_DESC=
       (GLOBAL_DBNAME=SRM)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (SID_NAME=SRM))
     (SID_DESC=
       (SID_NAME=SRM)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (GLOBAL_DBNAME=SRM_DGB))
     (SID_DESC=
       (SID_NAME=SRM)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (GLOBAL_DBNAME=SRM_DGMGRL)))</code></pre>
</li>
<li><p><strong>配置主库的dg broker静态监听</strong></p>
<pre><code> LISTENER=
   (DESCRIPTION=
     (ADDRESS_LIST=
       (ADDRESS=(PROTOCOL=tcp)(HOST=192.168.100.204)(PORT=1521))
       (ADDRESS=(PROTOCOL=ipc)(KEY=extproc))))
 SID_LIST_LISTENER=
   (SID_LIST=
     (SID_DESC=
       (GLOBAL_DBNAME=SRMDG_DGMGRL)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (SID_NAME=SRMDG))
     (SID_DESC=
       (GLOBAL_DBNAME=SRMDG)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (SID_NAME=SRMDG))
     (SID_DESC=
       (GLOBAL_DBNAME=SRMDG_DGB)
       (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
       (SID_NAME=SRMDG)))</code></pre>
</li>
<li><p><strong>在主库和备库分别启动dg_broker</strong></p>
<pre><code> -- show parameter dg_broker_start;
 alter system set dg_broker_start=true;</code></pre>
</li>
<li><p><strong>在主库创建dg_broker配置文件</strong></p>
<pre><code> [oracle@localhost ~]$ dgmgrl
 DGMGRL for Linux: Version 11.2.0.4.0 - 64bit Production

 Copyright (c) 2000, 2009, Oracle. All rights reserved.

 Welcome to DGMGRL, type &quot;help&quot; for information.
 DGMGRL&gt; connect sys/oracle@srm
 Connected.
 DGMGRL&gt; help
 DGMGRL&gt; help create 

 create configuration yg_srm_dgBroker as
   primary database is SRM
   connect identifier is SRM;</code></pre>
</li>
<li><p><strong>添加standby备库</strong></p>
<pre><code> DGMGRL&gt; add database srmdg as connect identifier is srmdg maintained as physical;</code></pre>
</li>
<li><p><strong>查看配置</strong></p>
<pre><code> DGMGRL&gt; show CONFIGURATION;

 Configuration - yg_srm_dgbroker

   Protection Mode: MaxPerformance
   Databases:
     srm   - Primary database
     srmdg - Physical standby database (disabled)

 --如果standby未启用，则启用一下
 DGMGRL&gt; enable database srmdg;</code></pre>
</li>
<li><p><strong>再次查看详细配置</strong></p>
<pre><code> DGMGRL&gt; show configuration verbose

 Configuration - yg_srm_dgbroker

   Protection Mode: MaxPerformance
   Databases:
     srm   - Primary database
     srmdg - Physical standby database

   Properties:
     FastStartFailoverThreshold      = &#39;30&#39;
     OperationTimeout                = &#39;30&#39;
     FastStartFailoverLagLimit       = &#39;30&#39;
     CommunicationTimeout            = &#39;1800&#39;
     ObserverReconnect               = &#39;0&#39;
     FastStartFailoverAutoReinstate  = &#39;TRUE&#39;
     FastStartFailoverPmyShutdown    = &#39;TRUE&#39;
     BystandersFollowRoleChange      = &#39;ALL&#39;
     ObserverOverride                = &#39;FALSE&#39;
     ExternalDestination1            = &#39;&#39;
     ExternalDestination2            = &#39;&#39;
     PrimaryLostWriteAction          = &#39;CONTINUE&#39;

 Fast-Start Failover: DISABLED

 Configuration Status:
 SUCCESS</code></pre>
</li>
<li><p><strong>第一次测试switchover</strong></p>
<pre><code> DGMGRL&gt; switchover to srmdg</code></pre>
</li>
<li><p><strong>验证</strong></p>
<pre><code> SQL&gt; set line 200
 SQL&gt; col name for a20
 SQL&gt; col open_mode for a20
 SQL&gt; select name, open_mode, database_role, switchover_status from v$database;</code></pre>
</li>
<li><p><strong>第二次切换回来</strong></p>
<pre><code>DGMGRL&gt; switchover to srm</code></pre>
<blockquote>
<p><strong>在本地搭建dg broker过程中备库启用后遇到错误：Error: ORA-16664: unable to receive the result from a database</strong></p>
</blockquote>
<hr>
<pre><code># trace/drcSRM.log日志一直报错 Physical Standby Database srmdg Error ORA-16664 
# trace/alert_SRM.log日志中一直报错 , Fatal NI connect error 12514, connecting to: (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.100.204)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=srmdg_DGB)(CID=(PROGRAM=oracle)(HOST=localhost.localdomain)(USER=oracle))))

解决：

最后在 监听配置文件中加上 sid_DGB 的静态监听才解决,也就是上面的静态监听中的这段：

(SID_DESC=
(GLOBAL_DBNAME=SRMDG_DGB)
(ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
(SID_NAME=SRMDG))</code></pre>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/03/data_guard_broker_%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" data-id="ckdegxsst0001iscs926g2grd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/broker/" rel="tag">broker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/data-guard/" rel="tag">data guard</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/08/03/12.2.0_RAC_ORACLE_HOME_chmod%E5%92%8Cchown%E6%83%A8%E6%A1%88%E6%81%A2%E5%A4%8D%E4%B8%80%E4%BE%8B/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          12.2.0 RAC ORACLE_HOME chmod/chown惨案恢复一例
        
      </div>
    </a>
  
  
    <a href="/2020/08/03/duplicate%E5%9F%BA%E4%BA%8Eactive%E6%BA%90%E5%BA%93%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">duplicate db from active database/duplicate复制数据库</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/centos6/">centos6</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/oracle/">oracle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/oracle-12c-rac/">oracle 12c rac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/oracle12c/">oracle12c</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/postgrepsql/">postgrepsql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/windows/">windows</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/11g/" rel="tag">11g</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GoldenGate/" rel="tag">GoldenGate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bios/" rel="tag">bios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/block/" rel="tag">block</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/broker/" rel="tag">broker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cas/" rel="tag">cas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/" rel="tag">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos6/" rel="tag">centos6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clone/" rel="tag">clone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/data-guard/" rel="tag">data guard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/database/" rel="tag">database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/duplicate/" rel="tag">duplicate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/event/" rel="tag">event</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flashback/" rel="tag">flashback</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/githup/" rel="tag">githup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/incarnation/" rel="tag">incarnation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oracle12c/" rel="tag">oracle12c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pdb/" rel="tag">pdb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pg10/" rel="tag">pg10</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgrepsql/" rel="tag">postgrepsql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rac/" rel="tag">rac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/refresh/" rel="tag">refresh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rman/" rel="tag">rman</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql-trace/" rel="tag">sql_trace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unison/" rel="tag">unison</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%BB%E6%9D%BF/" rel="tag">主板</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86/" rel="tag">正向代理</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/11g/" style="font-size: 15px;">11g</a> <a href="/tags/GoldenGate/" style="font-size: 15px;">GoldenGate</a> <a href="/tags/bios/" style="font-size: 10px;">bios</a> <a href="/tags/block/" style="font-size: 10px;">block</a> <a href="/tags/broker/" style="font-size: 10px;">broker</a> <a href="/tags/cas/" style="font-size: 10px;">cas</a> <a href="/tags/centos/" style="font-size: 15px;">centos</a> <a href="/tags/centos6/" style="font-size: 17.5px;">centos6</a> <a href="/tags/clone/" style="font-size: 10px;">clone</a> <a href="/tags/data-guard/" style="font-size: 12.5px;">data guard</a> <a href="/tags/database/" style="font-size: 10px;">database</a> <a href="/tags/duplicate/" style="font-size: 15px;">duplicate</a> <a href="/tags/event/" style="font-size: 10px;">event</a> <a href="/tags/flashback/" style="font-size: 10px;">flashback</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/githup/" style="font-size: 10px;">githup</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/incarnation/" style="font-size: 10px;">incarnation</a> <a href="/tags/linux/" style="font-size: 12.5px;">linux</a> <a href="/tags/oracle/" style="font-size: 20px;">oracle</a> <a href="/tags/oracle12c/" style="font-size: 10px;">oracle12c</a> <a href="/tags/pdb/" style="font-size: 10px;">pdb</a> <a href="/tags/pg10/" style="font-size: 10px;">pg10</a> <a href="/tags/postgrepsql/" style="font-size: 10px;">postgrepsql</a> <a href="/tags/rac/" style="font-size: 10px;">rac</a> <a href="/tags/refresh/" style="font-size: 10px;">refresh</a> <a href="/tags/rman/" style="font-size: 12.5px;">rman</a> <a href="/tags/sql-trace/" style="font-size: 10px;">sql_trace</a> <a href="/tags/unison/" style="font-size: 10px;">unison</a> <a href="/tags/%E4%B8%BB%E6%9D%BF/" style="font-size: 10px;">主板</a> <a href="/tags/%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86/" style="font-size: 10px;">正向代理</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/08/03/postgresql-%E5%90%8C%E6%9C%BA%E7%89%A9%E7%90%86%E5%BC%82%E6%AD%A5%E4%B8%BB%E5%A4%87%E5%BA%93%E6%90%AD%E5%BB%BA/">postgresql-同机物理异步主备库搭建</a>
          </li>
        
          <li>
            <a href="/2020/08/03/12.2.0_RAC_ORACLE_HOME_chmod%E5%92%8Cchown%E6%83%A8%E6%A1%88%E6%81%A2%E5%A4%8D%E4%B8%80%E4%BE%8B/">12.2.0 RAC ORACLE_HOME chmod/chown惨案恢复一例</a>
          </li>
        
          <li>
            <a href="/2020/08/03/data_guard_broker_%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/">data guard broker 简单使用</a>
          </li>
        
          <li>
            <a href="/2020/08/03/duplicate%E5%9F%BA%E4%BA%8Eactive%E6%BA%90%E5%BA%93%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93/">duplicate db from active database/duplicate复制数据库</a>
          </li>
        
          <li>
            <a href="/2020/08/03/duplicate%E5%9F%BA%E4%BA%8E%E6%BA%90%E5%BA%93rman%E5%A4%87%E4%BB%BD%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93/">duplicate db from rman backup/duplicate复制数据库</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 姚刚<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>